function createchest(){if(ccc=document.URL,d0="https://phpcis.chshb.gov.tw/consultationMainPage/",d1="https://phpcis.chshb.gov.tw/populanceRegistration",d2="https://phpcis.chshb.gov.tw/registration",d3="https://phpcis.chshb.gov.tw/registration/",d4="https://phpcis.chshb.gov.tw/registration/create",d5="https://phpcis.chshb.gov.tw/familyMedicine",d6="https://phpcis.chshb.gov.tw/populanceConsultation/",d7="https://phpcis.chshb.gov.tw/medicalRefee",d8="https://phpcis.chshb.gov.tw/disease",document.getElementById("myDraggable")&&document.getElementById("myDraggable").remove(),ccc.includes(d0))t();else if(ccc==d1)r();else if(ccc==d2)l();else if(ccc.includes(d3)||ccc==d4)o();else if(ccc==d5)s();else if(ccc.includes(d6)){if(escape_populanceConsultation){let e=ccc.split(d6)[1];window.history.pushState({},"","/consultationMainPage/"+e),window.dispatchEvent(new PopStateEvent("popstate"))}}else ccc==d7?p():ccc==d8&&u();function t(){y(),button_5line=document.createElement("button"),button_5line.textContent="變5行",button_5line.style.width="80px",button_5line.style.left="2px",button_5line.style.top="2px",button_5line.style.position="absolute",button_5line.addEventListener("click",_),myDraggable.appendChild(button_5line),button_HE=document.createElement("button"),button_HE.textContent="成健問卷",button_HE.style.width="80px",button_HE.style.left="84px",button_HE.style.top="2px",button_HE.style.position="absolute",button_HE.addEventListener("click",v),myDraggable.appendChild(button_HE),button_OR=document.createElement("button"),button_OR.textContent="口篩問卷",button_OR.style.width="80px",button_OR.style.left="166px",button_OR.style.top="2px",button_OR.style.position="absolute",button_OR.addEventListener("click",C),myDraggable.appendChild(button_OR),button_goup=document.createElement("button"),button_goup.textContent="▲",button_goup.style.width="40px",button_goup.style.left="248px",button_goup.style.top="2px",button_goup.style.position="absolute",button_goup.addEventListener("click",P),myDraggable.appendChild(button_goup),button_godown=document.createElement("button"),button_godown.textContent="▼",button_godown.style.width="40px",button_godown.style.left="288px",button_godown.style.top="2px",button_godown.style.position="absolute",button_godown.addEventListener("click",x),myDraggable.appendChild(button_godown),button_changetype=document.createElement("button"),button_changetype.textContent="換身份",button_changetype.style.width="80px",button_changetype.style.left="2px",button_changetype.style.top="34px",button_changetype.style.position="absolute",button_changetype.addEventListener("click",D),myDraggable.appendChild(button_changetype),button_toHE=document.createElement("button"),button_toHE.textContent="跳轉成健",button_toHE.style.width="80px",button_toHE.style.left="84px",button_toHE.style.top="34px",button_toHE.style.position="absolute",button_toHE.addEventListener("click",I),myDraggable.appendChild(button_toHE),button_toOR=document.createElement("button"),button_toOR.textContent="跳轉口篩",button_toOR.style.width="80px",button_toOR.style.left="166px",button_toOR.style.top="34px",button_toOR.style.position="absolute",button_toOR.addEventListener("click",w),myDraggable.appendChild(button_toOR),button_NIIS=document.createElement("button"),button_NIIS.textContent="NIIS",button_NIIS.style.width="80px",button_NIIS.style.left="248px",button_NIIS.style.top="34px",button_NIIS.style.position="absolute",button_NIIS.addEventListener("click",K),myDraggable.appendChild(button_NIIS),button_toREG=document.createElement("button"),button_toREG.textContent="切換掛號",button_toREG.style.width="80px",button_toREG.style.left="2px",button_toREG.style.top="66px",button_toREG.style.position="absolute",button_toREG.addEventListener("click",E),myDraggable.appendChild(button_toREG),button_showdrug=document.createElement("button"),button_showdrug.textContent="藥品圖片",button_showdrug.style.width="80px",button_showdrug.style.left="84px",button_showdrug.style.top="66px",button_showdrug.style.position="absolute",button_showdrug.addEventListener("click",L),myDraggable.appendChild(button_showdrug),button_showdata=document.createElement("button"),button_showdata.textContent="檢驗彙總",button_showdata.style.width="80px",button_showdata.style.left="166px",button_showdata.style.top="66px",button_showdata.style.position="absolute",button_showdata.addEventListener("click",k),myDraggable.appendChild(button_showdata),button_trydebug=document.createElement("button"),button_trydebug.textContent="簡易除錯",button_trydebug.style.width="80px",button_trydebug.style.left="248px",button_trydebug.style.top="66px",button_trydebug.style.position="absolute",button_trydebug.addEventListener("click",V),myDraggable.appendChild(button_trydebug)}function r(){y(),button_NIIS=document.createElement("button"),button_NIIS.textContent="NIIS",button_NIIS.style.width="80px",button_NIIS.style.left="2px",button_NIIS.style.top="2px",button_NIIS.style.position="absolute",button_NIIS.addEventListener("click",K),myDraggable.appendChild(button_NIIS),button_autocomplete=document.createElement("button"),button_autocomplete.textContent="批次完成",button_autocomplete.style.width="80px",button_autocomplete.style.left="84px",button_autocomplete.style.top="2px",button_autocomplete.style.position="absolute",button_autocomplete.addEventListener("click",T),myDraggable.appendChild(button_autocomplete),button_reflash=document.createElement("button"),button_reflash.textContent="更新列表",button_reflash.style.width="80px",button_reflash.style.left="166px",button_reflash.style.top="2px",button_reflash.style.position="absolute",button_reflash.addEventListener("click",N),myDraggable.appendChild(button_reflash),button_autocompletev2=document.createElement("button"),button_autocompletev2.textContent="帶入標準處方_身分",button_autocompletev2.style.width="160px",button_autocompletev2.style.left="248px",button_autocompletev2.style.top="2px",button_autocompletev2.style.position="absolute",button_autocompletev2.addEventListener("click",S),myDraggable.appendChild(button_autocompletev2),button_autocompletesingle=document.createElement("button"),button_autocompletesingle.textContent="帶入標準處方_個案",button_autocompletesingle.style.width="160px",button_autocompletesingle.style.left="410px",button_autocompletesingle.style.top="2px",button_autocompletesingle.style.position="absolute",button_autocompletesingle.addEventListener("click",X),myDraggable.appendChild(button_autocompletesingle),button_changenumber=document.createElement("button"),button_changenumber.textContent="新舊切換",button_changenumber.style.width="80px",button_changenumber.style.left="572px",button_changenumber.style.top="2px",button_changenumber.style.position="absolute",button_changenumber.addEventListener("click",R),myDraggable.appendChild(button_changenumber),button_listdelete=document.createElement("button"),button_listdelete.textContent="快速刪除",button_listdelete.style.width="80px",button_listdelete.style.left="654px",button_listdelete.style.top="2px",button_listdelete.style.position="absolute",button_listdelete.addEventListener("click",q),myDraggable.appendChild(button_listdelete),myDraggable.style.height="35px",myDraggable.style.width="739px",myDraggable.style.left=window.innerWidth-739+"px"}function l(){y(),button_NIIS=document.createElement("button"),button_NIIS.textContent="NIIS",button_NIIS.style.width="80px",button_NIIS.style.left="2px",button_NIIS.style.top="2px",button_NIIS.style.position="absolute",button_NIIS.addEventListener("click",K),myDraggable.appendChild(button_NIIS),div_fasttype=document.createElement("div"),div_fasttype.textContent="身分",div_fasttype.style.width="40px",div_fasttype.style.left="82px",div_fasttype.style.top="2px",div_fasttype.style.position="absolute",div_fasttype.style.textAlign="center",myDraggable.appendChild(div_fasttype),input_fasttype=document.createElement("input"),input_fasttype.id="input_fasttype",temptype&&(input_fasttype.value=temptype),input_fasttype.style.width="40px",input_fasttype.style.left="124px",input_fasttype.style.top="2px",input_fasttype.style.position="absolute",input_fasttype.style.textAlign="center",myDraggable.appendChild(input_fasttype),button_fastreg=document.createElement("button"),button_fastreg.textContent="快速掛號",button_fastreg.style.width="80px",button_fastreg.style.left="166px",button_fastreg.style.top="2px",button_fastreg.style.position="absolute",button_fastreg.addEventListener("click",H),myDraggable.appendChild(button_fastreg),button_showvaccine=document.createElement("button"),button_showvaccine.textContent="顯示疫苗",button_showvaccine.style.width="80px",button_showvaccine.style.left="2px",button_showvaccine.style.top="34px",button_showvaccine.style.position="absolute",button_showvaccine.addEventListener("click",O),myDraggable.appendChild(button_showvaccine),button_countvaccine=document.createElement("button"),button_countvaccine.textContent="算疫苗",button_countvaccine.style.width="80px",button_countvaccine.style.left="84px",button_countvaccine.style.top="34px",button_countvaccine.style.position="absolute",button_countvaccine.addEventListener("click",M),myDraggable.appendChild(button_countvaccine),button_changenumber=document.createElement("button"),button_changenumber.textContent="新舊切換",button_changenumber.style.width="80px",button_changenumber.style.left="166px",button_changenumber.style.top="34px",button_changenumber.style.position="absolute",button_changenumber.addEventListener("click",R),myDraggable.appendChild(button_changenumber),button_reflash=document.createElement("button"),button_reflash.textContent="重整畫面",button_reflash.style.width="80px",button_reflash.style.left="2px",button_reflash.style.top="66px",button_reflash.style.position="absolute",button_reflash.addEventListener("click",N),myDraggable.appendChild(button_reflash),button_detail=document.createElement("button"),button_detail.textContent="基本資料",button_detail.style.width="80px",button_detail.style.left="84px",button_detail.style.top="66px",button_detail.style.position="absolute",button_detail.addEventListener("click",B),myDraggable.appendChild(button_detail),button_OPDhistory=document.createElement("button"),button_OPDhistory.textContent="就醫紀錄",button_OPDhistory.style.width="80px",button_OPDhistory.style.left="166px",button_OPDhistory.style.top="66px",button_OPDhistory.style.position="absolute",button_OPDhistory.addEventListener("click",A),myDraggable.appendChild(button_OPDhistory),myDraggable.style.width="248px",myDraggable.style.left=window.innerWidth-248-borderx+"px"}function o(){y(),button_NIIS=document.createElement("button"),button_NIIS.textContent="NIIS",button_NIIS.style.width="80px",button_NIIS.style.left="2px",button_NIIS.style.top="2px",button_NIIS.style.position="absolute",button_NIIS.addEventListener("click",K),myDraggable.appendChild(button_NIIS),div_fasttype=document.createElement("div"),div_fasttype.textContent="身分",div_fasttype.style.width="40px",div_fasttype.style.left="82px",div_fasttype.style.top="2px",div_fasttype.style.position="absolute",div_fasttype.style.textAlign="center",myDraggable.appendChild(div_fasttype),input_fasttype=document.createElement("input"),input_fasttype.id="input_fasttype",temptype&&(input_fasttype.value=temptype),input_fasttype.style.width="40px",input_fasttype.style.left="124px",input_fasttype.style.top="2px",input_fasttype.style.position="absolute",input_fasttype.style.textAlign="center",myDraggable.appendChild(input_fasttype),button_fastreg=document.createElement("button"),button_fastreg.textContent="快速掛號",button_fastreg.style.width="80px",button_fastreg.style.left="166px",button_fastreg.style.top="2px",button_fastreg.style.position="absolute",button_fastreg.addEventListener("click",H),myDraggable.appendChild(button_fastreg),button_showvaccine=document.createElement("button"),button_showvaccine.textContent="顯示疫苗",button_showvaccine.style.width="80px",button_showvaccine.style.left="2px",button_showvaccine.style.top="34px",button_showvaccine.style.position="absolute",button_showvaccine.addEventListener("click",O),myDraggable.appendChild(button_showvaccine),button_detail=document.createElement("button"),button_detail.textContent="基本資料",button_detail.style.width="80px",button_detail.style.left="84px",button_detail.style.top="34px",button_detail.style.position="absolute",button_detail.addEventListener("click",B),myDraggable.appendChild(button_detail),button_OPDhistory=document.createElement("button"),button_OPDhistory.textContent="就醫紀錄",button_OPDhistory.style.width="80px",button_OPDhistory.style.left="166px",button_OPDhistory.style.top="34px",button_OPDhistory.style.position="absolute",button_OPDhistory.addEventListener("click",A),myDraggable.appendChild(button_OPDhistory),myDraggable.style.width="248px",myDraggable.style.height="70px",myDraggable.style.left=window.innerWidth-248-borderx+"px"}function s(){y(),button_FMdebug=document.createElement("button"),button_FMdebug.textContent="醫療群除錯",button_FMdebug.style.width="160px",button_FMdebug.style.height="66px",button_FMdebug.style.left="2px",button_FMdebug.style.top="2px",button_FMdebug.style.position="absolute",button_FMdebug.addEventListener("click",F),myDraggable.appendChild(button_FMdebug),myDraggable.style.width="164px",myDraggable.style.height="70px",myDraggable.style.left=window.innerWidth-164-borderx+"px"}function p(){y(),button_countmonth=document.createElement("button"),button_countmonth.textContent="查天數",button_countmonth.style.width="160px",button_countmonth.style.height="66px",button_countmonth.style.left="2px",button_countmonth.style.top="2px",button_countmonth.style.position="absolute",button_countmonth.addEventListener("click",J),myDraggable.appendChild(button_countmonth),myDraggable.style.width="164px",myDraggable.style.height="70px",myDraggable.style.left=window.innerWidth-1164-borderx+"px"}function u(){y(),button_changeicd=document.createElement("button"),button_changeicd.textContent="改ICD",button_changeicd.style.width="160px",button_changeicd.style.height="66px",button_changeicd.style.left="2px",button_changeicd.style.top="2px",button_changeicd.style.position="absolute",button_changeicd.addEventListener("click",m),myDraggable.appendChild(button_changeicd),myDraggable.style.width="164px",myDraggable.style.height="70px",myDraggable.style.left=window.innerWidth-1364-borderx+"px"}function m(){const e=document.URL;if("https://phpcis.chshb.gov.tw/disease"==e){const e=document.getElementsByClassName("table table-striped table-bordered role-list__role-table commonTable")[0];find=!1;let t="";for(i=1;i<e.rows.length;i++)if(e.rows[i].cells[0].children[0].checked){t=e.rows[i].cells[1].children[0].href,find=!0;break}if(find){const e=new XMLHttpRequest,n="https://phpcis.chshb.gov.tw/api/v1/clinics/settings/find";e.open("GET",n,!1),e.send();const i=e.responseText,r=JSON.parse(i),l=r.result.clinicId,o=t.split("/")[t.split("/").length-1],s="https://phpcis.chshb.gov.tw/api/v1/diseases/find?diseaseId="+o;e.open("GET",s,!1),e.send();const a=e.responseText;let c,d=JSON.parse(a).result,p=prompt("新的ICD9名稱",d.ICD9Name);null!=p&&""!=p&&(d.ICD9Name=p);let u=prompt("新的ICD10代碼",d.ICD10Code);null!=u&&""!=u&&(d.ICD10Code=u);let m=prompt("新的ICD10名稱",d.ICD10Name);null!=m&&""!=m&&(d.ICD10Name=m),d.clinicId=l;const h="https://phpcis.chshb.gov.tw/api/v1/diseases/update";e.open("POST",h,!1),e.setRequestHeader("Content-Type","application/json"),e.send(JSON.stringify(d));let b=e.responseText,g;200==JSON.parse(b).code&&(alert("修改完成"),document.querySelector("#root > div.wrapper > main > div > div.mb-2.btn-toolbar > button.commonBtn.btn.btn-success").click())}else alert("無選擇")}else alert("需在疾病資料列表執行"),window.location.href="https://phpcis.chshb.gov.tw/disease"}function y(){thewidth=330,theheight=100,borderx=20,bordery=50;var e=document.createElement("div");function t(t){posX=mouseX-t.clientX,posY=mouseY-t.clientY,mouseX=t.clientX,mouseY=t.clientY,e.style.left=e.offsetLeft-posX+"px",e.style.top=e.offsetTop-posY+"px"}function n(){document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",n)}e.id="myDraggable",e.style.width=thewidth+"px",e.style.left=window.innerWidth-thewidth-borderx+"px",e.style.height=theheight+"px",e.style.top=bordery+"px",e.style.background="#f9f9f9",e.style.border="1px solid #ccc",e.style.position="absolute",e.style.cursor="move",e.style.zIndex="9999",document.body.insertBefore(e,document.body.firstChild),e.addEventListener("mousedown",function(e){mouseX=e.clientX,mouseY=e.clientY,document.addEventListener("mousemove",t),document.addEventListener("mouseup",n)})}async function _(){if(cc=document.URL,d1="https://phpcis.chshb.gov.tw/consultationMainPage/",d2="https://phpcis.chshb.gov.tw/populanceRegistration",d3="https://phpcis.chshb.gov.tw/registration",cc.includes(d1)){for(theform=document.querySelector("#root > div.wrapper > main > div > form"),i=0;i<theform.children[1].childElementCount;i++)"治療結束日:"==theform.children[1].children[i].textContent?theform.children[1].children[i].children[0].textContent="結束日":"療程起日:"==theform.children[1].children[i].textContent?theform.children[1].children[i].children[0].textContent="起日":"慢連處方"==theform.children[1].children[i].textContent&&(theform.children[1].children[i].children[0].children[0].children[1].textContent="連處");for(ccc=document.getElementsByClassName("consultationMainPage__value"),document.querySelector("#root > footer")&&document.querySelector("#root > footer").remove(),document.querySelector("#root > div.wrapper")&&(mainwrapper=document.querySelector("#root > div.wrapper"),mainwrapper.style.height="900px",mainwrapper.style.alignItems="flex-start"),document.querySelector("#root > div.wrapper > main > div > div:nth-child(21)")&&(document.querySelector("#root > div.wrapper > main > div > div:nth-child(21)").style.marginBottom="0px"),aaa=[],i=0;i<ccc.length;i++)if("途徑:"==ccc[i].innerText){ri=i;break}ccc[ri].hidden=!0,ccc[ri+1].hidden=!0,uu=document.getElementsByClassName("col-xl-5 col-lg-5")[2],inputarea=uu.querySelectorAll("textarea"),inputspace=uu.getElementsByClassName("line"),inputspace[0].style.height="10rem",inputarea[0].rows=5,inputspace[1].style.height="12.5rem",inputarea[1].rows=5,ggg=document.getElementsByClassName("line prescription-diagnosis-area")[0],ggg.style.height="23.1rem",ggg.children[2].style.height="17vh",ggg.children[2].children[0].style.height="17vh",prevention=document.getElementById("prevention"),null==prevention&&(prevention=document.createElement("div"),prevention.setAttribute("id","prevention"),title=document.createTextNode("預防保健項目"),prevention.style.border="1px solid black",prevention.style.width="500px",prevention.appendChild(title),prevention_L1=document.createElement("div"),prevention_L1.setAttribute("id","prevention_L1"),prevention.appendChild(prevention_L1),prevention_L2=document.createElement("div"),prevention_L2.setAttribute("id","prevention_L2"),prevention.appendChild(prevention_L2),prevention_L3=document.createElement("div"),prevention_L3.setAttribute("id","prevention_L3"),prevention.appendChild(prevention_L3),prevention_L4=document.createElement("div"),prevention_L4.setAttribute("id","prevention_L4"),prevention.appendChild(prevention_L4),prevention_L5=document.createElement("div"),prevention_L5.setAttribute("id","prevention_L5"),prevention.appendChild(prevention_L5),ggg.appendChild(prevention),plan=document.createElement("div"),plan.setAttribute("id","plan"),plan.style.border="1px solid black",plan.style.width="375px",plantitle=document.createTextNode("試辦計畫"),plan.appendChild(plantitle),plan_L1=document.createElement("div"),plan_L1.setAttribute("id","plan_L1"),plan.appendChild(plan_L1),plan_L2=document.createElement("div"),plan_L2.setAttribute("id","plan_L2"),plan.appendChild(plan_L2),plan_L3=document.createElement("div"),plan_L3.setAttribute("id","plan_L3"),plan.appendChild(plan_L3),horizontalContainer=document.createElement("div"),horizontalContainer.style.display="flex",horizontalContainer.appendChild(prevention),horizontalContainer.appendChild(plan),ggg.appendChild(horizontalContainer)),registrationId=cc.split("/")[cc.split("/").length-1],furl="https://phpcis.chshb.gov.tw/api/v1/registrations/find?registrationId="+registrationId+"&type=consultation",await fetch(furl,{headers:{"content-type":"application/json"},body:null,method:"GET"}).then(e=>e.text()).then(e=>{res=JSON.parse(e),personalInfoId=res.result.personalInfoId,age=res.result.age,gender=res.result.gender,furl2="https://phpcis.chshb.gov.tw/api/v1/personal_infos/preventions_histories/list?personalInfoId="+personalInfoId,fetch(furl2,{headers:{"content-type":"application/json"},body:null,method:"GET"}).then(e=>e.text()).then(e=>{for(res2=JSON.parse(e),HE=["HE"],FO=["FO"],OR=["OR"],PA=["PA"],MA=["MA"],i=1;i<=res2.result.length;i++)"02"==res2.result[res2.result.length-i].preventionTag?res2.result[res2.result.length-i].serviceCode.includes("Y")?HE.splice(HE.length-1,1):HE.push(res2.result[res2.result.length-i]):"03"==res2.result[res2.result.length-i].preventionTag?res2.result[res2.result.length-i].serviceCode.includes("Y")?PA.splice(PA.length-1,1):PA.push(res2.result[res2.result.length-i]):"06"==res2.result[res2.result.length-i].preventionTag?res2.result[res2.result.length-i].serviceCode.includes("Y")?MA.splice(MA.length-1,1):MA.push(res2.result[res2.result.length-i]):"07"==res2.result[res2.result.length-i].preventionTag?res2.result[res2.result.length-i].serviceCode.includes("Y")?FO.splice(FO.length-1,1):FO.push(res2.result[res2.result.length-i]):"08"==res2.result[res2.result.length-i].preventionTag&&(res2.result[res2.result.length-i].serviceCode.includes("Y")?OR.splice(OR.length-1,1):OR.push(res2.result[res2.result.length-i]));nowy=(new Date).getFullYear(),age>=65?HE.length>1?(LHE=HE[HE.length-1].treatmentDate.split("-")[0],nowy-LHE>=1?HEC="O , 65歲1年1次":HEC="X , 65歲未滿1年",theclinic=HE[HE.length-1].clinicName,theclinic=theclinic.replace("彰化基督教醫療財團法人","").replace("秀傳醫療社團法人",""),theclinic.length>12&&(theclinic=theclinic.substring(theclinic.length-12,theclinic.length)),HEC=HEC+","+theclinic+"("+HE[HE.length-1].treatmentDate+")"):HEC="O , 65歲1年1次":age>=40&&age<65?HE.length>1?(LHE=HE[HE.length-1].treatmentDate.split("-")[0],nowy-LHE>=3?HEC="O , 45-64歲3年1次":HEC="X , 45-64歲未滿3年"):HEC="O , 45-65歲3年1次":HEC="X , 未滿40歲不可成健","2"==gender?age>=30?PA.length>1?(LPA=PA[PA.length-1].treatmentDate.split("-")[0],nowy-LPA>=6?PAC="O , 曾抹且6年未抹":nowy-LPA>=3&&nowy-LPA<6?PAC="O , 曾抹且3年未抹":nowy-LPA>=1?PAC="O , 曾抹且可抹":nowy-LPA<1&&(PAC="X , 曾抹未滿1年"),theclinic=PA[PA.length-1].clinicName,theclinic=theclinic.replace("彰化基督教醫療財團法人","").replace("秀傳醫療社團法人",""),theclinic.length>12&&(theclinic=theclinic.substring(theclinic.length-12,theclinic.length)),PAC=PAC+","+theclinic+"("+PA[PA.length-1].treatmentDate+")"):PAC="O , 不曾抹(首篩)":PAC="X , 未滿30歲":PAC="X , 需女性","2"==gender?age>=45&&age<70?MA.length>1?(LMA=MA[MA.length-1].treatmentDate.split("-")[0],nowy-LMA>=2?MAC="O , 可乳攝":MAC="X , 未滿2年",theclinic=MA[MA.length-1].clinicName,theclinic=theclinic.replace("彰化基督教醫療財團法人","").replace("秀傳醫療社團法人",""),theclinic.length>12&&(theclinic=theclinic.substring(theclinic.length-12,theclinic.length)),MAC=MAC+","+theclinic+"("+MA[MA.length-1].treatmentDate+")"):MAC="O , 不曾乳攝(首篩)":age>=70?MAC="X , 超過70歲":MAC="X , 未滿45歲":MAC="X , 需女性",age>=50&&age<75?FO.length>1?(LFO=FO[FO.length-1].treatmentDate.split("-")[0],nowy-LFO>=2?FOC="O , 可FOBT":FOC="X , 未滿2年",theclinic=FO[FO.length-1].clinicName,theclinic=theclinic.replace("彰化基督教醫療財團法人","").replace("秀傳醫療社團法人",""),theclinic.length>12&&(theclinic=theclinic.substring(theclinic.length-12,theclinic.length)),FOC=FOC+","+theclinic+"("+FO[FO.length-1].treatmentDate+")"):FOC="O , 不曾FOBT(首篩)":age>=75?FOC="X , 超過75歲":FOC="X , 未滿50歲",age>=30?OR.length>1?(LOR=OR[OR.length-1].treatmentDate.split("-")[0],nowy-LOR>=2?ORC="O , 有菸檳史可":ORC="X , 間隔未滿2年",theclinic=OR[OR.length-1].clinicName,theclinic=theclinic.replace("彰化基督教醫療財團法人","").replace("秀傳醫療社團法人",""),theclinic.length>12&&(theclinic=theclinic.substring(theclinic.length-12,theclinic.length)),ORC=ORC+","+theclinic+"("+OR[OR.length-1].treatmentDate+")"):ORC="O , 有菸檳史可(首篩)":ORC="X , 未滿30歲",msg2="\n成健: "+HEC+"\n腸篩: "+FOC+"\n子抹: "+PAC+"\n乳攝: "+MAC+"\n口篩: "+ORC,prevention_L1=document.getElementById("prevention_L1"),prevention_L1.textContent="成健: "+HEC,prevention_L2=document.getElementById("prevention_L2"),prevention_L2.textContent="腸篩: "+FOC,prevention_L3=document.getElementById("prevention_L3"),prevention_L3.textContent="子抹: "+PAC,prevention_L4=document.getElementById("prevention_L4"),prevention_L4.textContent="乳攝: "+MAC,prevention_L5=document.getElementById("prevention_L5"),prevention_L5.textContent="口篩: "+ORC,furl3="https://phpcis.chshb.gov.tw/api/v1/personal_infos/chronic_cares_histories/list?personalInfoId="+personalInfoId,fetch(furl3,{headers:{"content-type":"application/json"},body:null,method:"GET"}).then(e=>e.text()).then(e=>{for(res3=JSON.parse(e),DKD=[],DM=["DM"],yearDMC=0,yearDM1=0,CKD=["CKD"],DKDC="DKD: 無",DMC="DM: 無",CKDC="CKD: 無",cc=res3.result.chronicCares,i=1;i<cc.length+1;i++)"1"==cc[cc.length-i].chronicCareType?("P1407C"!=cc[cc.length-i].chronicCareCode&&"P1409C"!=cc[cc.length-i].chronicCareCode&&"P1411C"!=cc[cc.length-i].chronicCareCode||(DM=["DM"]),yearDM2=cc[cc.length-i].treatmentDate.split("-")[0],yearDM1==yearDM2?yearDMC+=1:(yearDMC=1,yearDM1=yearDM2),DM.push(cc[cc.length-i])):"2"==cc[cc.length-i].chronicCareType?("P4301C"==cc[cc.length-i].chronicCareCode&&(CKD=["CKD"]),CKD.push(cc[cc.length-i])):"3"==cc[cc.length-i].chronicCareType&&(0==DKD.length&&(DKD=DM),yearDM2=cc[cc.length-i].treatmentDate.split("-")[0],yearDM1==yearDM2?yearDMC+=1:(yearDMC=1,yearDM1=yearDM2),"P7002C"==cc[cc.length-i].chronicCareCode&&(DKD=["DKD"]),DKD.push(cc[cc.length-i]));DKD.length>1?(treatmentDate=DKD[DKD.length-1].treatmentDate,date_1=new Date(treatmentDate),date_2=new Date(date_1.getTime()+66528e5),mky=date_2.getUTCFullYear()-1911,mm0=date_2.getUTCMonth(),mm0+=1,mkm=("00"+mm0).substring(("00"+mm0).length-2,("00"+mm0).length),dd0=date_2.getUTCDate(),mkd=("00"+dd0).substring(("00"+dd0).length-2,("00"+dd0).length),mkdd=mky+mkm+mkd,now=new Date,yearDMC<4?(now>=date_2?DKDC="DKD: O, 已申報"+yearDMC+"次,":DKDC="DKD: X, 已申報"+yearDMC+"次,",5==DKD.length?DKDC=DKDC+mkdd+"後可申報年度P7002C":DKDC=DKDC+mkdd+"後可申報追蹤P7001C"):now.getFullYear()>1*treatmentDate.split("-")[0]?(now>=date_2?DKDC="DKD: O, 新年度, ":DKDC="DKD: X, 新年度, ",5==DKD.length?DKDC+="可申報年度P7002C":DKDC+="可申報追蹤P7001C"):DKDC="("+yearDMC+")DKD: X, 今年已申報4次",DMC="DM: X, 已轉DKD",CKDC="CKD: X, 已轉DKD"):(DM.length>1&&(treatmentDate=DM[DM.length-1].treatmentDate,"P1410C"==DM[DM.length-1].chronicCareCode||"P1411C"==DM[DM.length-1].chronicCareCode?DMtype=2:DMtype=1,date_1=new Date(treatmentDate),date_2=new Date(date_1.getTime()+66528e5),mky=date_2.getUTCFullYear()-1911,mm0=date_2.getUTCMonth(),mm0+=1,mkm=("00"+mm0).substring(("00"+mm0).length-2,("00"+mm0).length),dd0=date_2.getUTCDate(),mkd=("00"+dd0).substring(("00"+dd0).length-2,("00"+dd0).length),mkdd=mky+mkm+mkd,now=new Date,yearDMC<4?(now>=date_2?DMC="DM: O, 已申報"+yearDMC+"次,":DMC="DM: X, 已申報"+yearDMC+"次,",5==DM.length?"1"==DMtype?DMC=DMC+mkdd+"後可申報一階年度P1409C":DMC=DMC+mkdd+"後可申報二階年度P1411C":"1"==DMtype?DMC=DMC+mkdd+"後可申報一階追蹤P1408C":DMC=DMC+mkdd+"後可申報二階追蹤P1410C"):now.getFullYear()>1*treatmentDate.split("-")[0]?(now>=date_2?DMC="DM: O, 新年度, ":DMC="DM: X, 新年度, ",5==DM.length?"1"==DMtype?DMC+="可申報一階年度P1409C":DMC+="可申報二階年度P1411C":"1"==DMtype?DMC+="可申報一階追蹤P1408C":DMC+="可申報二階追蹤P1410C"):DMC="("+yearDMC+")DM: X ,今年已申報4次"),CKD.length>1&&(treatmentDate=CKD[CKD.length-1].treatmentDate,date_1=new Date(treatmentDate),date_2=new Date(date_1.getTime()+139104e5),mky=date_2.getUTCFullYear()-1911,mm0=date_2.getUTCMonth(),mm0+=1,mkm=("00"+mm0).substring(("00"+mm0).length-2,("00"+mm0).length),dd0=date_2.getUTCDate(),mkd=("00"+dd0).substring(("00"+dd0).length-2,("00"+dd0).length),mkdd=mky+mkm+mkd,now=new Date,now>=date_2?CKDC="CKD: O,"+mkdd+"後可申報":CKDC="CKD: X,"+mkdd+"後可申報")),plan_L1=document.getElementById("plan_L1"),plan_L1.textContent=DKDC,plan_L2=document.getElementById("plan_L2"),plan_L2.textContent=DMC,plan_L3=document.getElementById("plan_L3"),plan_L3.textContent=CKDC,0==document.getElementsByClassName("badge badge-secondary").length&&alert("非2.0掛號")}).catch(e=>console.log(e))}).catch(e=>console.log(e))}).catch(e=>console.log(e))}else alert("需在看診頁面使用")}function v(){if(cc=document.URL,d1="https://phpcis.chshb.gov.tw/consultationMainPage",cc.includes(d1)){var e=document.querySelector("body > div.fade.modal.show > div > div");null!==e?"新增預防保健資料"==e.children[0].textContent?(GEN=document.getElementsByClassName("consultationMainPage__value")[10].textContent,bb=document.getElementsByClassName("consultationMainPage__value")[6].textContent,bby=bb.substring(0,4),yyyy=(new Date).getFullYear(),age=yyyy-bby,vd0=document.getElementsByClassName("consultationMainPage__value")[27].value,vd=vd0.split(" ")[1].split("-")[0]-1911+"/"+vd0.split(" ")[1].split("-")[1]+"/"+vd0.split(" ")[1].split("-")[2],P_ID=document.getElementsByClassName("consultationMainPage__value")[2].textContent,P_NAME=document.getElementsByClassName("consultationMainPage__value")[4].textContent,yyy="000"+(bb.split("-")[0]-1911),P_BIR=yyy.substring(yyy.length-3,yyy.length)+"/"+bb.split("-")[1]+"/"+bb.split("-")[2],P_S=4,document.querySelector("#uncontrolled-tab-example-tabpane-tab1 > div:nth-child(9) > input[type=checkbox]:nth-child(1)").checked?P_S=0:document.querySelector("#uncontrolled-tab-example-tabpane-tab1 > div:nth-child(9) > input[type=checkbox]:nth-child(2)").checked?P_S=1:document.querySelector("#uncontrolled-tab-example-tabpane-tab1 > div:nth-child(9) > input[type=checkbox]:nth-child(3)").checked?P_S=2:document.querySelector("#uncontrolled-tab-example-tabpane-tab1 > div:nth-child(9) > input[type=checkbox]:nth-child(4)").checked&&(P_S=3),4==P_S&&(document.querySelector("#uncontrolled-tab-example-tabpane-tab1 > div:nth-child(9) > input[type=checkbox]:nth-child(1)").click(),P_S=0),document.querySelector("#uncontrolled-tab-example-tabpane-tab1 > div:nth-child(13) > input[type=checkbox]:nth-child(1)").checked?P_B=0:document.querySelector("#uncontrolled-tab-example-tabpane-tab1 > div:nth-child(13) > input[type=checkbox]:nth-child(2)").checked?P_B=1:document.querySelector("#uncontrolled-tab-example-tabpane-tab1 > div:nth-child(13) > input[type=checkbox]:nth-child(3)").checked&&(P_B=2),P_HTN=document.querySelector("#uncontrolled-tab-example-tabpane-tab1 > div:nth-child(3) > input[type=checkbox]:nth-child(1)").checked,P_HTN?PP_HTN=1:PP_HTN=0,P_DM=document.querySelector("#uncontrolled-tab-example-tabpane-tab1 > div:nth-child(3) > input[type=checkbox]:nth-child(2)").checked,P_DM?PP_DM=1:PP_DM=0,P_LIP=document.querySelector("#uncontrolled-tab-example-tabpane-tab1 > div:nth-child(3) > input[type=checkbox]:nth-child(3)").checked,P_LIP?PP_LIP=1:PP_LIP=0,P_CAD=document.querySelector("#uncontrolled-tab-example-tabpane-tab1 > div:nth-child(3) > input[type=checkbox]:nth-child(4)").checked,P_CAD?PP_CAD=1:PP_CAD=0,P_CVA=document.querySelector("#uncontrolled-tab-example-tabpane-tab1 > div:nth-child(3) > input[type=checkbox]:nth-child(5)").checked,P_CVA?PP_CVA=1:PP_CVA=0,P_CKD=document.querySelector("#uncontrolled-tab-example-tabpane-tab1 > div:nth-child(4) > input[type=checkbox]:nth-child(1)").checked,P_CKD?PP_CKD=1:PP_CKD=0,P_HBV=document.querySelector("#uncontrolled-tab-example-tabpane-tab1 > div:nth-child(4) > input[type=checkbox]:nth-child(2)").checked,P_HCV=document.querySelector("#uncontrolled-tab-example-tabpane-tab1 > div:nth-child(4) > input[type=checkbox]:nth-child(3)").checked,P_PSY=document.querySelector("#uncontrolled-tab-example-tabpane-tab1 > div:nth-child(4) > input[type=checkbox]:nth-child(4)").checked,P_CA=document.querySelector("#uncontrolled-tab-example-tabpane-tab1 > div:nth-child(4) > input[type=checkbox]:nth-child(5)").checked,P_COUGH=document.querySelector("#uncontrolled-tab-example-tabpane-tab1 > div:nth-child(16) > input[type=checkbox]:nth-child(3)").checked,P_D1=document.querySelector("#uncontrolled-tab-example-tabpane-tab1 > div:nth-child(17) > input[type=checkbox]:nth-child(3)").checked,P_D2=document.querySelector("#uncontrolled-tab-example-tabpane-tab1 > div:nth-child(18) > input[type=checkbox]:nth-child(3)").checked,H_smoke=document.querySelector("#uncontrolled-tab-example-tabpane-tab1 > div:nth-child(9) > input[type=checkbox]:nth-child(1)").checked,H_drink=document.querySelector("#uncontrolled-tab-example-tabpane-tab1 > div:nth-child(11) > input[type=checkbox]:nth-child(1)").checked,H_betel=document.querySelector("#uncontrolled-tab-example-tabpane-tab1 > div:nth-child(13) > input[type=checkbox]:nth-child(1)").checked,H_exercise=document.querySelector("#uncontrolled-tab-example-tabpane-tab1 > div:nth-child(15) > input[type=checkbox]:nth-child(3)").checked,PE_height=document.querySelector("#uncontrolled-tab-example-tabpane-tab2 > div:nth-child(2) > input[type=number]:nth-child(1)").value,PE_weight=document.querySelector("#uncontrolled-tab-example-tabpane-tab2 > div:nth-child(2) > input[type=number]:nth-child(3)").value,PE_SBP=document.querySelector("#uncontrolled-tab-example-tabpane-tab2 > div:nth-child(3) > input[type=number]:nth-child(1)").value,PE_DBP=document.querySelector("#uncontrolled-tab-example-tabpane-tab2 > div:nth-child(3) > input[type=number]:nth-child(2)").value,PE_WC=document.querySelector("#uncontrolled-tab-example-tabpane-tab2 > div:nth-child(3) > input[type=number]:nth-child(4)").value,PE_BMI=document.querySelector("#uncontrolled-tab-example-tabpane-tab2 > div:nth-child(4) > input[type=number]").value,PE_VR1=document.querySelector("#uncontrolled-tab-example-tabpane-tab2 > div:nth-child(6) > input[type=number]:nth-child(2)").value,PE_VL1=document.querySelector("#uncontrolled-tab-example-tabpane-tab2 > div:nth-child(6) > input[type=number]:nth-child(4)").value,PE_VR2=document.querySelector("#uncontrolled-tab-example-tabpane-tab2 > div:nth-child(7) > input[type=number]:nth-child(2)").value,PE_VL2=document.querySelector("#uncontrolled-tab-example-tabpane-tab2 > div:nth-child(7) > input[type=number]:nth-child(4)").value,PE_OR1=document.querySelector("#uncontrolled-tab-example-tabpane-tab2 > div:nth-child(10) > input[type=checkbox]:nth-child(3)").checked,PE_OR2=document.querySelector("#uncontrolled-tab-example-tabpane-tab2 > div:nth-child(10) > input[type=checkbox]:nth-child(4)").checked,L_UP=document.querySelector("#uncontrolled-tab-example-tabpane-tab3 > div:nth-child(3) > input[type=string]").value,L_AC=document.querySelector("#uncontrolled-tab-example-tabpane-tab3 > div:nth-child(5) > input[type=number]").value,L_TC=document.querySelector("#uncontrolled-tab-example-tabpane-tab3 > div:nth-child(6) > input[type=number]").value,L_TG=document.querySelector("#uncontrolled-tab-example-tabpane-tab3 > div:nth-child(7) > input[type=number]").value,L_HDL=document.querySelector("#uncontrolled-tab-example-tabpane-tab3 > div:nth-child(8) > input[type=number]").value,L_LDL=document.querySelector("#uncontrolled-tab-example-tabpane-tab3 > div:nth-child(9) > input[type=number]").value,L_GOT=document.querySelector("#uncontrolled-tab-example-tabpane-tab3 > div:nth-child(11) > input[type=number]").value,L_GPT=document.querySelector("#uncontrolled-tab-example-tabpane-tab3 > div:nth-child(12) > input[type=number]").value,L_CRE=document.querySelector("#uncontrolled-tab-example-tabpane-tab3 > div:nth-child(13) > input[type=number]").value,L_GFR=document.querySelector("#uncontrolled-tab-example-tabpane-tab3 > div:nth-child(14) > input[type=number]").value,L_BN=document.querySelector("#uncontrolled-tab-example-tabpane-tab3 > div:nth-child(15) > input[type=checkbox]:nth-child(2)").checked,L_BP=document.querySelector("#uncontrolled-tab-example-tabpane-tab3 > div:nth-child(15) > input[type=checkbox]:nth-child(3)").checked,L_NB=document.querySelector("#uncontrolled-tab-example-tabpane-tab3 > div:nth-child(15) > input[type=checkbox]:nth-child(4)").checked,L_CN=document.querySelector("#uncontrolled-tab-example-tabpane-tab3 > div:nth-child(16) > input[type=checkbox]:nth-child(2)").checked,L_CP=document.querySelector("#uncontrolled-tab-example-tabpane-tab3 > div:nth-child(16) > input[type=checkbox]:nth-child(3)").checked,L_NC=document.querySelector("#uncontrolled-tab-example-tabpane-tab3 > div:nth-child(16) > input[type=checkbox]:nth-child(4)").checked,S_smoke=document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(2) > input[type=checkbox]:nth-child(1)").checked,S_dring=document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(2) > input[type=checkbox]:nth-child(2)").checked,S_betel=document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(2) > input[type=checkbox]:nth-child(3)").checked,S_exer=document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(2) > input[type=checkbox]:nth-child(4)").checked,S_bw=document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(3) > input[type=checkbox]:nth-child(1)").checked,S_diet=document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(3) > input[type=checkbox]:nth-child(2)").checked,S_tra=document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(3) > input[type=checkbox]:nth-child(3)").checked,S_oral=document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(3) > input[type=checkbox]:nth-child(4)").checked,S_BN=document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(13) > input[type=checkbox]:nth-child(1)").checked,S_BP=document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(13) > input[type=checkbox]:nth-child(2)").checked,S_NB=document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(13) > input[type=checkbox]:nth-child(3)").checked,S_CN=document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(14) > input[type=checkbox]:nth-child(1)").checked,S_CP=document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(14) > input[type=checkbox]:nth-child(2)").checked,S_NC=document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(14) > input[type=checkbox]:nth-child(3)").checked,L_BN?HBV_status=0:L_BP?HBV_status=1:L_NB&&(HBV_status=2),L_CN?HCV_status=0:L_CP?HCV_status=1:L_NC&&(HCV_status=2),H_smoke==S_smoke&&document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(2) > input[type=checkbox]:nth-child(1)").click(),H_drink==S_dring&&document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(2) > input[type=checkbox]:nth-child(2)").click(),H_betel==S_betel&&document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(2) > input[type=checkbox]:nth-child(3)").click(),H_exercise==S_exer&&document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(2) > input[type=checkbox]:nth-child(4)").click(),(PE_BMI>24||GEN.includes("女")&&PE_WC>80||GEN.includes("男")&&PE_WC>90)!==S_bw&&document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(3) > input[type=checkbox]:nth-child(1)").click(),0==S_diet&&document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(3) > input[type=checkbox]:nth-child(2)").click(),(1==P_PSY||1==P_CVA||PE_VR1<.5&&PE_VR2<.5&&PE_VL1<.5&&PE_VL2<.5)!==S_tra&&document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(3) > input[type=checkbox]:nth-child(3)").click(),(1==PE_OR1||1==PE_OR2)!==S_oral&&document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(3) > input[type=checkbox]:nth-child(4)").click(),1==P_HTN||PE_SBP>179||PE_DBP>119?document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(6) > input[type=checkbox]:nth-child(6)").click():PE_SBP>159||PE_DBP>109?document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(6) > input[type=checkbox]:nth-child(5)").click():PE_SBP>134||PE_DBP>84?document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(6) > input[type=checkbox]:nth-child(2)").click():document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(6) > input[type=checkbox]:nth-child(1)").click(),1==P_DM||L_AC>199?document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(7) > input[type=checkbox]:nth-child(6)").click():L_AC>125?document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(7) > input[type=checkbox]:nth-child(5)").click():L_AC>100?document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(7) > input[type=checkbox]:nth-child(2)").click():document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(7) > input[type=checkbox]:nth-child(1)").click(),1==P_LIP||(1==P_DM||1==P_CAD||1==P_CVA)&&L_LDL>100||L_TG>400?document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(8) > input[type=checkbox]:nth-child(6)").click():L_LDL>190||1==P_HTN&&L_LDL>160?document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(8) > input[type=checkbox]:nth-child(5)").click():L_LDL>130||L_TG>150||L_TC>200||GEN.includes("女")&&L_HDL<50||GEN.includes("男")&&L_HDL<40?document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(8) > input[type=checkbox]:nth-child(2)").click():document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(8) > input[type=checkbox]:nth-child(1)").click(),1==P_CKD?document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(9) > input[type=checkbox]:nth-child(6)").click():L_GFR<60&&L_UP>15?document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(9) > input[type=checkbox]:nth-child(5)").click():L_GFR<60||L_UP>15?document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(9) > input[type=checkbox]:nth-child(2)").click():document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(9) > input[type=checkbox]:nth-child(1)").click(),L_GOT>200||L_GPT>200?document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(10) > input[type=checkbox]:nth-child(6)").click():1!=P_HBV&&1!=P_HCV||!(L_GOT>40||L_GPT>40)?1==P_HBV||1==P_HCV||L_GOT>40||L_GPT>40?document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(10) > input[type=checkbox]:nth-child(2)").click():document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(10) > input[type=checkbox]:nth-child(1)").click():document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(10) > input[type=checkbox]:nth-child(5)").click(),meta=0,(L_AC>99||1==P_DM)&&(meta+=1),(L_TG>149||1==P_LIP)&&(meta+=1),(PE_SBP>129||PE_DBP>84||1==P_HTN)&&(meta+=1),(GEN.includes("女")&&PE_WC>79||GEN.includes("男")&&PE_WC>89)&&(meta+=1),(GEN.includes("女")&&L_HDL<50||GEN.includes("男")&&L_HDL<40||1==P_LIP)&&(meta+=1),(1==P_HTN||1==P_DM||1==P_LIP)&&meta>2?document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(11) > input[type=checkbox]:nth-child(6)").click():meta>2?document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(11) > input[type=checkbox]:nth-child(5)").click():meta>0?document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(11) > input[type=checkbox]:nth-child(2)").click():document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(11) > input[type=checkbox]:nth-child(1)").click(),L_BN!==S_BN&&document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(13) > input[type=checkbox]:nth-child(1)").click(),L_BP!==S_BP&&document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(13) > input[type=checkbox]:nth-child(2)").click(),L_NB!==S_NB&&document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(13) > input[type=checkbox]:nth-child(3)").click(),L_CN!==S_CN&&document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(14) > input[type=checkbox]:nth-child(1)").click(),L_CP!==S_CP&&document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(14) > input[type=checkbox]:nth-child(2)").click(),L_NC!==S_NC&&document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(14) > input[type=checkbox]:nth-child(3)").click(),1==P_COUGH?document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(15) > input[type=checkbox]:nth-child(2)").click():document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(15) > input[type=checkbox]:nth-child(1)").click(),1==P_D1||1==P_D2?document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(16) > input[type=checkbox]:nth-child(2)").click():document.querySelector("#uncontrolled-tab-example-tabpane-tab4 > div:nth-child(16) > input[type=checkbox]:nth-child(1)").click(),document.querySelector("#uncontrolled-tab-example-tab-tab4").click()):alert("預防保健非成健"):(document.getElementById("ConsultationMainPage_consultationDropDown").click(),document.getElementsByClassName("alignRight")[0].click())}else alert("請在看診頁面使用")}function C(){if(theurl=document.URL,theurl.includes("https://phpcis.chshb.gov.tw/consultationMainPage/"))if(16==document.getElementsByName("visitTypeId")[1].value)if(null!=document.getElementById("education1")){if(input=prompt("輸入口篩編號\n含4碼問卷跟1-4碼檢查結果"),null!==input){if(changeevent=new Event("change",{bubbles:!0}),document.querySelector("#paymentType").options[1].selected=!0,document.querySelector("#paymentType").dispatchEvent(changeevent),document.querySelector("#OCSLocation").options[2].selected=!0,document.querySelector("#OCSLocation").dispatchEvent(changeevent),document.querySelector("#OCSDivision").options[3].selected=!0,document.querySelector("#OCSDivision").dispatchEvent(changeevent),input=input.toUpperCase(),numbers=input.match(/\d+/g)[0],input1=numbers.substring(0,1),input2=numbers.substring(1,2),input3=numbers.substring(2,3),input4=numbers.substring(3,4),input5=numbers.substring(4,input.length),document.querySelector("#education"+input1).click(),document.querySelector("#OCSBetel"+input2).click(),document.querySelector("#OCSSmoke"+input3).click(),"0"==input4?document.querySelector("#isOCSSymptom").click():document.querySelector("#noOCSSymptom").click(),document.querySelector("#oCSResult"+input5).click(),"0"!=input5){for(words=input.match(/\D+/g)[0],input6=words.toUpperCase(),portionlist=["AU","AD","BL","BR","CR","CL","DR","DL","ER","EL","FR","FL","GR","GL","HR","HL","IR","IL","JR","JL","KR","KL","MR","ML","L"],i=0;i<portionlist.length;i++)document.querySelector("#OCSResultPortion"+portionlist[i]).checked&&document.querySelector("#OCSResultPortion"+portionlist[i]).click();document.querySelector("#OCSResultPortion"+input6).click()}document.getElementById("uncontrolled-tab-example-tab-tab2").click(),document.querySelector("img").scrollIntoView()}}else document.getElementById("ConsultationMainPage_consultationDropDown").click(),document.getElementsByClassName("alignRight")[0].click();else alert("非口篩個案");else alert("非看診畫面")}async function P(){url=document.URL,u2="https://phpcis.chshb.gov.tw/consultationMainPage/",url.includes(u2)?(registrationId=url.split("/")[url.split("/").length-1],furl="https://phpcis.chshb.gov.tw/api/v1/registrations/find?registrationId="+registrationId+"&type=consultation",await fetch(furl,{headers:{"content-type":"application/json"},body:null,method:"GET"}).then(e=>e.text()).then(e=>{res=JSON.parse(e),visitTypeCode=res.result.visitTypeCode,shiftId=res.result.shiftId,console.log(res.result.shiftId),furl2="https://phpcis.chshb.gov.tw/api/v1/registrations/list?clinicId=4&shiftId="+shiftId,fetch(furl2,{headers:{"content-type":"application/json"},body:null,method:"GET"}).then(e=>e.text()).then(e=>{for(res2=JSON.parse(e),console.log(res2.result.length),find=0,i=0;i<res2.result.length;i++)if(res2.result[i].visitTypeCode==visitTypeCode){if(res2.result[i].registrationId>registrationId)break;res2.result[i].registrationId<registrationId&&(find=1,NregistrationId=res2.result[i].registrationId)}1==find?gotourl("consultationMainPage/"+NregistrationId):alert("shiftId "+shiftId+" 的 "+visitTypeCode+" 身分已到最上一筆")}).catch(e=>console.log(e))}).catch(e=>console.log(e))):alert("非看診頁面")}async function x(){url=document.URL,u2="https://phpcis.chshb.gov.tw/consultationMainPage/",url.includes(u2)?(registrationId=url.split("/")[url.split("/").length-1],furl="https://phpcis.chshb.gov.tw/api/v1/registrations/find?registrationId="+registrationId+"&type=consultation",await fetch(furl,{headers:{"content-type":"application/json"},body:null,method:"GET"}).then(e=>e.text()).then(e=>{res=JSON.parse(e),visitTypeCode=res.result.visitTypeCode,shiftId=res.result.shiftId,console.log(res.result.shiftId),furl2="https://phpcis.chshb.gov.tw/api/v1/registrations/list?clinicId=4&shiftId="+shiftId,fetch(furl2,{headers:{"content-type":"application/json"},body:null,method:"GET"}).then(e=>e.text()).then(e=>{for(res2=JSON.parse(e),console.log(res2.result.length),find=0,i=0;i<res2.result.length;i++)if(res2.result[i].registrationId>registrationId&&res2.result[i].visitTypeCode==visitTypeCode){find=1,NregistrationId=res2.result[i].registrationId;break}1==find?gotourl("consultationMainPage/"+NregistrationId):alert("shiftId "+shiftId+" 的 "+visitTypeCode+" 身分已到最後一筆")}).catch(e=>console.log(e))}).catch(e=>console.log(e))):alert("非看診頁面")}function D(){if(cc=document.URL,d1="https://phpcis.chshb.gov.tw/registration/create",d2="https://phpcis.chshb.gov.tw/consultationMainPage/",changeevent=new Event("change",{bubbles:!0}),insite=!1,alllist=[],cc==d1?(alllist=document.getElementsByClassName("form-control ampInput"),theage=age=(new Date).getFullYear()-1911-document.getElementsByClassName("form-control ampInput")[2].value.split("-")[0],insite=!0):cc.includes(d2)&&(alllist=document.getElementsByClassName("form-control consultationMainPage__value"),insite=!0),insite){for(find=!1,i=0;i<alllist.length;i++)"visitTypeId"==alllist[i].id?(targetelement=alllist[i],find=!0):"prevention"==alllist[i].name?targetelement2=alllist[i]:"preventionId"==alllist[i].name&&(targetelement3=alllist[i]);if(find){if(thecode=prompt("請輸入身分別代碼(區分大小寫)\n成健一階:1j或1J\n成健2階:2j或2J\n成健可能須執行2次"),thecode=thecode.toString(),"1j"==thecode||"1J"==thecode)if(cc==d1){for(i=0;i<targetelement.options.length;i++)if(targetelement.options[i].text.includes("69")){targetelement.options[i].selected=!0,targetelement.dispatchEvent(changeevent);break}targetelement2.value="02",targetelement2.dispatchEvent(changeevent),age>64?(targetelement3.value="10",targetelement3.dispatchEvent(changeevent)):(targetelement3.value="8",targetelement3.dispatchEvent(changeevent))}else alert("請在新增掛號時使用");else if("2j"==thecode||"2J"==thecode)if(cc==d1){for(i=0;i<targetelement.options.length;i++)if(targetelement.options[i].text.includes("69")){targetelement.options[i].selected=!0,targetelement.dispatchEvent(changeevent);break}targetelement2.value="02",targetelement2.dispatchEvent(changeevent),age>64?(targetelement3.value="11",targetelement3.dispatchEvent(changeevent)):(targetelement3.value="9",targetelement3.dispatchEvent(changeevent))}else alert("請在新增掛號時使用");else for(i=0;i<targetelement.options.length;i++)if(targetelement.options[i].text.includes(thecode)){targetelement.options[i].selected=!0,targetelement.dispatchEvent(changeevent);break}}else alert("不適用")}else alert("需在掛號頁面或看診頁面")}function I(){if(ccc=document.URL,ccc.includes("https://phpcis.chshb.gov.tw/consultationMainPage/")){for(sid=document.querySelector("#root > div.wrapper > main > div > form > div:nth-child(1) > div:nth-child(2) > div").textContent,xmlHttp=new XMLHttpRequest,URL="https://phpcis.chshb.gov.tw/api/v1/registrations/list?clinicId=4&personalId="+sid,xmlHttp.open("GET",URL,!1),xmlHttp.send(),uuu=JSON.parse(xmlHttp.responseText),UURL="",i=0;i<uuu.result.length;i++)if(uuu.result[i].personalId==sid&&"預防保健"==uuu.result[i].visitType){UURL="https://phpcis.chshb.gov.tw/consultationMainPage/"+uuu.result[i].registrationId;break}""!=UURL?gotourl(UURL):alert("無成健掛號資料")}else alert("請在看診畫面中使用")}async function w(){if(ccc=document.URL,ccc.includes("https://phpcis.chshb.gov.tw/consultationMainPage/")){for(sid=document.querySelector("#root > div.wrapper > main > div > form > div:nth-child(1) > div:nth-child(2) > div").textContent,xmlHttp=new XMLHttpRequest,URL="https://phpcis.chshb.gov.tw/api/v1/registrations/list?clinicId=4&personalId="+sid,xmlHttp.open("GET",URL,!1),xmlHttp.send(),uuu=JSON.parse(xmlHttp.responseText),UURL="",i=0;i<uuu.result.length;i++)if(uuu.result[i].personalId==sid&&"6G"==uuu.result[i].visitTypeCode){UURL="https://phpcis.chshb.gov.tw/consultationMainPage/"+uuu.result[i].registrationId;break}""!=UURL?gotourl(UURL):alert("無口篩掛號資料")}else alert("請在看診畫面中使用")}function E(){if(c=document.URL,na=c.split("/"),n=na[na.length-1],d1="https://phpcis.chshb.gov.tw/registration/",d2="https://phpcis.chshb.gov.tw/populanceConsultation/",d3="https://phpcis.chshb.gov.tw/consultationMainPage/",d4="https://phpcis.chshb.gov.tw/registration",c.includes(d1))gotourl("/consultationMainPage/"+n);else if(c.includes(d2)||c.includes(d3))gotourl("/registration/"+n);else if(c==d4){for(tb=document.getElementsByClassName("table table-striped table-bordered table-sm commonTable ampTableFontSize")[0],find=!1,i=1;i<tb.rows.length;i++)if(tb.rows[i].cells[0].children[0].checked){aaa=tb.rows[i].cells[2].children[0].href.split("/"),regid=aaa[aaa.length-1],find=!0;break}find?gotourl(d3+regid):alert("未選擇個案")}else alert("no")}function L(){if(tb=document.getElementsByClassName("table table-striped table-bordered table-condensed consultationMainPageTable commonTable")[0],tbl=tb.rows.length,thecode="",tbl>1)for(i=1;i<tbl;i++)if(tb.rows[i].cells[0].children[0].checked){thecode=tb.rows[i].cells[24].textContent;break}thecode=prompt("藥品代碼",thecode),""!=thecode?(newurl="https://script.google.com/macros/s/AKfycbzVKuBa099524WRQWkMEiwJjJnr0-dGzI6TmRI2yyI4CtXcLraDXHdlVpxSDG6G37X5/exec?code="+thecode,window.open(newurl)):alert("無藥品代碼")}function k(){if(ccc=document.URL,ccc.includes(d0)){for(sitelist={"社頭":"X001","秀水":"X002","溪湖":"X003","鹿港":"X004","永靖":"X007","埔心":"X008","福興":"X009","埔鹽":"X010","二水":"X011","田中":"X012","北斗":"X013","員林":"X014","和美":"X015","線西":"X016","花壇":"X017","芬園":"X018","伸港":"X019","大村":"X020","二林":"X021","田尾":"X022","埤頭":"X023","芳苑":"X024","大城":"X025","竹塘":"X026","溪州":"X027","東區":"X028","南西北":"X029"},clinictitle=document.getElementsByClassName("header__brand__title")[0].textContent,sid=document.querySelector("#root > div.wrapper > main > div > form > div:nth-child(1) > div:nth-child(2) > div").textContent,allsite=Object.keys(sitelist),sitecode="",i=0;i<allsite.length;i++)if(clinictitle.includes(allsite[i])){sitecode=sitelist[allsite[i]];break}""!=sitecode?(newurl="https://iiirrkimo.github.io/checkdata/checkdata.html?thesite="+sitecode+"&theID="+sid,window.open(newurl)):alert("出錯了")}else alert("請在看診畫面中使用")}function V(){if(cc=document.URL,d1="https://phpcis.chshb.gov.tw/consultationMainPage/",cc.includes(d1)){errmsg="出現以下錯誤",CKDICD=["A1811","A5275","C641","C642","C649","C7A093","Z5112","D3000","D3001","D3002","D3A093","D4100","D4101","D4102","D4110","D4111","D4112","D4120","D4121","D4122","E1121","E1122","E1129","E1321","E1322","E1329","E1021","E1022","E1029","E1121","E1122","E1129","E1165","E1021","E1065","E748","M1030","M10311","M10312","M10319","M10321","M10322","M10329","M10331","M10332","M10339","M10341","M10342","M10349","M10351","M10352","M10359","M10361","M10362","M10369","M10371","M10372","M10379","M1038","M1039","N200","M1030","D593","I120","I129","I1311","I132","I701","I7581","I722","I7773","I773","K767","N000","N001","N002","N003","N004","N005","N006","N007","N010","N011","N012","N013","N014","N015","N016","N017","N018","N019","N08","N008","N009","N044","N021","N022","N023","N041","N042","N024","N025","N026","N027","N043","N044","N045","N046","N020","N040","N028","N047","N048","N029","N049","N032","N031","N033","N034","N035","N036","N037","N038","","N030","N039","N059","N052","N062","N072","N053","N054","N055","N063","N064","N065","N073","N074","N075","N059","N171","N172","E1021","E1121","N16","N050","N051","N056","N057","N058","N060","N061","N066","N067","N068","N070","N071","N076","N077","N078","N140","N141","N142","N143","N144","N150","N158","N059","N069","N079","N159","N170","N171","N172","N178","N179","N181","N182","N183","N189","N19","N261","N269","N250","N251","N2581","N2589","N259","N131","N132","N1330","N1339","O10419","O10411","O10412","O10413","O1042","O1043","Q6101","Q613","Q612","Q6111","Q6119","Q614","Q615","Q615","Q6102","Q618","Q6239","Q6211","Q6212","Q6231","Q6232","Q620","Q6210","Q6211","Q622","R944"],DMICD=["E08","E09","E10","E11","E12","E13"],vaccinelist=["KC00452206","KC00452209","KC00452221","K000301206","K000301209","K000351206","K000351209","K000906206","X000153206","K000702206","X000154206","X000155229","K000440206","X000157206","J000085216","K000364206","K000510206","K000450206","K000480206","K000456206","K000456209","K000501206","K000501209","K000967206","K000981206","X000164206","X000165206"],translist=["01036C","01037C"];try{mainICD=document.getElementsByClassName("table table-striped table-bordered table-sm consultationMainPageTable commonTable")[7].children[1].rows[0].cells[1].textContent.replaceAll(".","")}catch(e){mainICD="",errmsg=t(errmsg,"無診斷碼")}for(ttt=document.getElementsByClassName("table table-striped table-bordered table-condensed consultationMainPageTable commonTable")[0],i=0;i<ttt.children[0].rows[0].cells.length;i++)"申報代碼"==ttt.children[0].rows[0].cells[i].textContent&&(codecolumn=i),"主成分"==ttt.children[0].rows[0].cells[i].textContent&&(maincolumn=i),"自費組序"==ttt.children[0].rows[0].cells[i].textContent&&(selfpaycolumn=i),"醫囑名稱"==ttt.children[0].rows[0].cells[i].textContent&&(ordernamecolumn=i),"轉診院所代碼"==ttt.children[0].rows[0].cells[i].textContent&&(transsitecolumn=i),"慢箋"==ttt.children[0].rows[0].cells[i].textContent&&(ischroniccolumn=i);for(alllist=document.getElementsByClassName("form-control consultationMainPage__value"),changeevent=new Event("change",{bubbles:!0}),i=0;i<alllist.length;i++)"visitTypeId"==alllist[i].id&&(visitTypeId=alllist[i].value),"caseTypeId"==alllist[i].id&&(caseTypeId=alllist[i].value),"shareId"==alllist[i].id&&(shareId=alllist[i].value);for(checklist=document.getElementsByClassName("form-check-input"),i=0;i<checklist.length;i++)"isChronic"==checklist[i].name&&(isChronic=checklist[i].checked);for(codearray=[],P1found=!1,P2found=!1,P3found=!1,P4found=!1,P5found=!1,SSfound=!1,chronicchronic=!1,i=1;i<ttt.rows.length;i++)thecode=ttt.rows[i].cells[codecolumn].textContent,themain=ttt.rows[i].cells[maincolumn].textContent,"P1407C"==thecode&&(DMICD.includes(mainICD.substring(0,3))||(errmsg=t(errmsg,"DM收案診斷不符")),"22"!=visitTypeId&&(errmsg=t(errmsg,"DM收案身分別應為6a"))),"P1408C"!=thecode&&"P1410C"!=thecode||"23"!=visitTypeId&&(errmsg=t(errmsg,"DM追蹤身分別應為6b")),"P1409C"!=thecode&&"P1411C"!=thecode||"24"!=visitTypeId&&(errmsg=t(errmsg,"DM年度身分別應為6c")),"P4301C"==thecode&&(CKDICD.includes(mainICD)||(errmsg=t(errmsg,"CKD收案診斷不符")),"26"!=visitTypeId&&(errmsg=t(errmsg,"CKD收案身分別應為6s"))),"P4302C"==thecode&&"27"!=visitTypeId&&(errmsg=t(errmsg,"CKD追蹤身分別應為6t")),"P7001C"==thecode&&"23"!=visitTypeId&&(errmsg=t(errmsg,"DKD追蹤身分別應為6b")),"P7002C"==thecode&&"24"!=visitTypeId&&(errmsg=t(errmsg,"DKD年度身分別應為6c")),"E4003C"!=thecode&&"E4004C"!=thecode||("69"!=visitTypeId&&(errmsg=t(errmsg,"TT/IGRA身分別應為6T結核病接觸者")),"37"!=caseTypeId&&(errmsg=t(errmsg,"TT/IGRA案件別應為C4行政協助無健保結核病患就醫案件"))),(themain.toUpperCase().includes("ISONIAZID")||themain.toUpperCase().includes("RIFAPENTINE"))&&("4"!=visitTypeId&&(errmsg=t(errmsg,"LTBI身分別應為65")),"21"!=caseTypeId&&(errmsg=t(errmsg,"LTBI案件別應為06結核病"))),"28"==visitTypeId&&("申報代碼"==thecode||"A2051C"==thecode||vaccinelist.includes(thecode)||translist.includes(thecode)||(errmsg=t(errmsg,"6x兒童預注身分別不可開立接種、疫苗及轉診以外處方")),vaccinelist.includes(thecode)&&""==ttt.rows[i].cells[selfpaycolumn].children[0].children[0].value&&(errmsg=t(errmsg,ttt.rows[i].cells[ordernamecolumn].textContent+"須有自費組序")),"9"!=shareId&&(errmsg=t(errmsg,"6x兒童預注身分別部分負擔為009"))),translist.includes(thecode)&&""==ttt.rows[i].cells[transsitecolumn].children[0].children[0].value&&(errmsg=t(errmsg,"轉診需填寫轉診院所代號")),"31"!=visitTypeId&&"1"!=visitTypeId&&"2"!=visitTypeId&&"3"!=visitTypeId||"19"!=caseTypeId&&"23"!=caseTypeId&&(errmsg=t(errmsg,"健保身分建議案件類別為04或09")),"E1022C"!=thecode&&"E1027C"!=thecode||"18"!=caseTypeId&&(errmsg=t(errmsg,"戒菸處置身分別為6S")),"22"==visitTypeId&&"P1407C"==thecode&&(P1found=!0),"23"==visitTypeId&&("P1408C"!=thecode&&"P1410C"!=thecode&&"P7001C"!=thecode||(P2found=!0)),"24"==visitTypeId&&("P1409C"!=thecode&&"P1411C"!=thecode&&"P7002C"!=thecode||(P3found=!0)),"26"==visitTypeId&&"P4301C"==thecode&&(P4found=!0),"27"==visitTypeId&&"P4302C"==thecode&&(P5found=!0),"18"==visitTypeId&&"E1027C"==thecode&&(SSfound=!0),theischronic=ttt.rows[i].cells[ischroniccolumn].children[0].checked,theischronic&&(chronicchronic=!0),!isChronic&&theischronic&&(errmsg=t(errmsg,"開立慢籤藥物請使用F12建立慢籤資訊")),codearray.push(thecode);for(isChronic&&(chronicchronic||(errmsg=t(errmsg,"F12建立慢籤但無勾選慢籤藥物"))),P1found||"22"!=visitTypeId||(errmsg=t(errmsg,"6a身分別需開立P1407C")),P2found||"23"!=visitTypeId||(errmsg=t(errmsg,"6b身分別需開立P1408C或P14010C或P70010C")),P3found||"24"!=visitTypeId||(errmsg=t(errmsg,"6c身分別需開立P1409C或P14011C或P7002C")),P4found||"26"!=visitTypeId||(errmsg=t(errmsg,"6s身分別需開立P4301C")),P5found||"27"!=visitTypeId||(errmsg=t(errmsg,"6t身分別需開立P4302C")),SSfound||"18"!=visitTypeId||(errmsg=t(errmsg,"戒菸身分別需開立E1027C")),thedupli=0,i=0;i<ttt.rows.length;i++)thecode=ttt.rows[i].cells[codecolumn].textContent,thecodecount=e(codearray,thecode),thecodecount>1&&(ttt.rows[i].style.backgroundColor="#FF5151",thedupli+=1);thedupli>0&&(errmsg+="\n重複開立處方，請檢查下方紅色欄位"),"出現以下錯誤"!=errmsg?(errmsg+="\n是否仍存檔?",result=confirm(errmsg),result&&document.getElementsByClassName("consultationMainPage__btn btn btn-primary")[0].click()):document.getElementsByClassName("consultationMainPage__btn btn btn-primary")[0].click()}else alert("請在看診頁面使用");function e(e,t){for(var n=0,i=0;i<e.length;i++)e[i]===t&&n++;return n}function t(e,t){return e.includes(t)||(e=e+"\n"+t),e}}function T(){if(c=document.URL,d1="https://phpcis.chshb.gov.tw/populanceRegistration",d2="https://phpcis.chshb.gov.tw/registration",c==d1||c==d2){if(date0=document.getElementsByClassName("form-control ampInput")[0].value,date1=date0.split(" ")[1],period1=document.getElementsByClassName("form-control ampInput")[1].selectedOptions[0].value,room0=document.getElementsByClassName("form-control ampInput")[2].selectedOptions[0].innerText.split(" ")[0],xmlHttp=new XMLHttpRequest,URL="https://phpcis.chshb.gov.tw/api/v1/clinics/settings/find",xmlHttp.open("GET",URL,!1),xmlHttp.send(),res=xmlHttp.responseText,jres=JSON.parse(res),200==jres.code){for(ok=jres.result,upj={},upj.FOBTHospitalId=ok.CCSHospitalId,upj.FOBTLocation="",upj.adultTestType="Y",upj.clinicId=ok.clinicId,upj.healthExamHospitalId=ok.healthExamHospitalId,upj.isChargeReceipt=!1,upj.isIncludeAdultLevelOne=!0,upj.isIncludeAdultLevelTwo=!0,upj.isIncludeChild=!0,upj.isIncludeChildGuardian=!0,upj.isIncludeChildScreening=!0,upj.isIncludeCovid19=!0,upj.isIncludeFOBT=!0,upj.isIncludeFreeInfluenza=!0,upj.isIncludeFreePneumonia=!0,upj.isIncludeInfluenza=!0,upj.isIncludeOral=!0,upj.isIncludePneumonia=!0,upj.isIncludePneumonia13PCV=!0,upj.isIncludeUterus=!0,upj.isReplace=!1,upj.markFromIntegratedScreening=!1,upj.oralDivision="3",upj.oralLocation="2",upj.period=period1,URL2="https://phpcis.chshb.gov.tw/api/v1/rooms/list?clinicId="+upj.clinicId,xmlHttp.open("GET",URL2,!1),xmlHttp.send(),res2=xmlHttp.responseText,jres2=JSON.parse(res2),i=0;i<jres2.result.length;i++)if(jres2.result[i].name.includes(room0)){room1=jres2.result[i].roomId;break}if(upj.roomId=room1,upj.treatmentDate=date1,upjs=JSON.stringify(upj),URL3="https://phpcis.chshb.gov.tw/api/v1/preventions/batch_complete/create",xmlHttp.open("POST",URL3,!1),xmlHttp.setRequestHeader("Content-Type","application/json; charset=utf-8"),xmlHttp.send(upjs),res3=xmlHttp.responseText,jres3=JSON.parse(res3),200==jres3.code){for(alllist=document.getElementsByClassName("sidebar__nav")[0],i=0;i<alllist.childElementCount;i++)if("掛號"==alllist.children[i].innerText)regc=i;else if("門診看診作業"==alllist.children[i].innerText){opdc=i;break}alert("批次完成"),changeevent=new Event("change",{bubbles:!0}),document.getElementsByClassName("form-control ampInput")[2].dispatchEvent(changeevent)}else alert(jres3.message)}}else alert("請在掛號資訊列表或候診患者查詢使用")}function N(){ccc=document.URL,d1="https://phpcis.chshb.gov.tw/registration",d2="https://phpcis.chshb.gov.tw/populanceRegistration",ccc.includes("https://phpcis.chshb.gov.tw")?ccc!=d1&&ccc!=d2||(changeevent=new Event("change",{bubbles:!0}),document.getElementsByClassName("form-control ampInput")[2].dispatchEvent(changeevent)):alert("請在PHPCIIS網域中使用")}function S(){function e(){var e=document.createElement("div");e.id="myDraggable_2",e.style.width="450px",e.style.background="#f9f9f9",e.style.border="1px solid #ccc",e.style.position="absolute",e.style.cursor="move",e.style.zIndex="9999",e.style.left=Math.ceil(window.innerWidth/2-225)+"px",e.style.top="300px",document.body.insertBefore(e,document.body.firstChild),e.addEventListener("mousedown",function(e){mouseX=e.clientX,mouseY=e.clientY,document.addEventListener("mousemove",h),document.addEventListener("mouseup",b)});var t=document.createElement("div");t.textContent="身分代號",e.appendChild(t);var n=document.createElement("select");for(n.id="visittypecombo",n.style.width="250px",i=0;i<json_visittype.result.length;i++)newOption=document.createElement("option"),visitTypeCode=json_visittype.result[i].visitTypeCode,visitTypeName=json_visittype.result[i].visitTypeName,newOption.text=visitTypeCode+" "+visitTypeName,newOption.value=visitTypeName,n.appendChild(newOption);t.appendChild(n);var r=document.createElement("button");r.id="confirmbutton",r.textContent="確定執行",r.style.height="50px",r.style.left="315px",r.style.position="absolute",r.addEventListener("click",d),t.appendChild(r);var l=document.createElement("button");l.id="exitbutton",l.textContent="關閉",l.style.height="50px",l.style.left="398px",l.style.position="absolute",l.addEventListener("click",u),t.appendChild(l);var o=document.createElement("div");o.textContent="標準處方",e.appendChild(o);var s=document.createElement("select");for(s.id="ordercombo",s.style.width="250px",i2=0;i2<json_freq_orders.result.length;i2++)newOption=document.createElement("option"),freqOrderCode=json_freq_orders.result[i2].freqOrderCode,freqOrderName=json_freq_orders.result[i2].freqOrderName,freqOrderId=json_freq_orders.result[i2].freqOrderId,newOption.text=freqOrderCode+" : "+freqOrderName,newOption.value=freqOrderId,s.appendChild(newOption);o.appendChild(s),s.addEventListener("change",m);var a=document.createElement("div");a.id="line3",a.textContent="主診斷:",e.appendChild(a);var c=document.createElement("div");function d(){if(tb=document.getElementsByClassName("table table-striped table-bordered table-sm role-list__role-table commonTable")[0],array_patient=[],tb.rows[1].cells.length>2)for(i9=1;i9<tb.rows.length;i9++)visittype=tb.rows[i9].cells[7].textContent,href=tb.rows[i9].cells[4].children[0].href.split("/"),registrationId=href[href.length-1],visittype.includes(n.value)&&array_patient.push(registrationId);array_patient.length>0?json_orderdetail.result.diseases.length>0?json_orderdetail.result.FreqOrderPrescription.length>0?confirm(n.value+" 身份別共 "+array_patient.length+" 位，是否執行?")&&p():alert("該標準處方無處置"):alert("該標準處方無診斷"):alert("該身分別無個案")}function p(){for(errmsg="",i3=0;i3<array_patient.length;i3++){for(registrationId=array_patient[i3],url_registrationId="https://phpcis.chshb.gov.tw/api/v1/registrations/find?registrationId="+registrationId,xmlHttp=new XMLHttpRequest,xmlHttp.open("GET",url_registrationId,!1),xmlHttp.send(),res_registrations=xmlHttp.responseText,jres_registrations=JSON.parse(res_registrations),url_health_records="https://phpcis.chshb.gov.tw/api/v1/health_records/find?registrationId="+registrationId,xmlHttp=new XMLHttpRequest,xmlHttp.open("GET",url_health_records,!1),xmlHttp.send(),res_health_records=xmlHttp.responseText,jres_health_records=JSON.parse(res_health_records),forinjectdate={},forinjectdate.CC=json_orderdetail.result.CC,forinjectdate.PE=json_orderdetail.result.PE,forinjectdate.abnormalTreatmentSeqNo=null,forinjectdate.benefitTypeCode=jres_registrations.result.benefitTypeCode,forinjectdate.benefitTypeId=jres_registrations.result.benefitTypeId,forinjectdate.bmi=1*jres_health_records.result.bmi,16==jres_registrations.result.caseTypeId?(forinjectdate.caseTypeId=23,forinjectdate.caseTypeCode="09"):(forinjectdate.caseTypeId=jres_registrations.result.caseTypeId,forinjectdate.caseTypeCode=jres_registrations.result.caseTypeCode),forinjectdate.clinicId=json_freq_orders.result[0].clinicId,forinjectdate.codContent=jres_health_records.result.codContent,forinjectdate.courseHealthRecordId=jres_health_records.result.courseHealthRecordId,forinjectdate.dbp=1*jres_health_records.result.dbp,forinjectdate.diseases=[],i4=0;i4<json_orderdetail.result.diseases.length;i4++)tempdisease={},tempdisease.ICD10Code=json_orderdetail.result.diseases[i4].ICD10Code,tempdisease.diseaseId=json_orderdetail.result.diseases[i4].diseaseId,tempdisease.isChronic=json_orderdetail.result.diseases[i4].isChronic,0==i4?tempdisease.isMaster=!0:tempdisease.isMaster=!1,forinjectdate.diseases.push(tempdisease);for(forinjectdate.dispensingType=null,forinjectdate.glucoseAC=1*jres_health_records.result.glucoseAC,forinjectdate.glucosePC=1*jres_health_records.result.glucosePC,forinjectdate.healthRecordId=jres_health_records.result.healthRecordId,forinjectdate.height=1*jres_health_records.result.height,forinjectdate.homeCareType=jres_health_records.result.homeCareType,forinjectdate.isAutoCorrect=jres_health_records.result.isAutoCorrect,forinjectdate.isChronicPrescription=jres_health_records.result.isChronicPrescription,forinjectdate.isEmergencyVisit=jres_health_records.result.isEmergencyVisit,forinjectdate.isIncludeFamilyCare=jres_health_records.result.isIncludeFamilyCare,forinjectdate.isICCardWritten=jres_registrations.result.isICCard,forinjectdate.personalInfoId=jres_health_records.result.personalInfoId,forinjectdate.physicalExamHistoryId=jres_health_records.result.physicalExamHistoryId,forinjectdate.prescriptionDeadline=jres_health_records.result.prescriptionDeadline,forinjectdate.prescriptionNo=jres_health_records.result.prescriptionNo,forinjectdate.prescriptionReuseTimes=jres_health_records.result.prescriptionReuseTimes,forinjectdate.prescriptionType=jres_health_records.result.prescriptionType,forinjectdate.prescriptions=[],i5=0;i5<json_orderdetail.result.FreqOrderPrescription.length;i5++)tempprescription={},tempprescription.bureauTestCode=json_orderdetail.result.FreqOrderPrescription[i5].bureauTestCode,tempprescription.day=json_orderdetail.result.FreqOrderPrescription[i5].day,tempprescription.description="",tempprescription.drugCode=json_orderdetail.result.FreqOrderPrescription[i5].prescriptionCode,tempprescription.drugName=json_orderdetail.result.FreqOrderPrescription[i5].prescriptionName,tempprescription.drugRouteId=json_orderdetail.result.FreqOrderPrescription[i5].drugRouteId,tempprescription.drugUsageId=json_orderdetail.result.FreqOrderPrescription[i5].drugUsageId,tempprescription.endTime=null,tempprescription.isApplicable=json_orderdetail.result.FreqOrderPrescription[i5].isApplicable,tempprescription.isChronicPrescription=json_orderdetail.result.FreqOrderPrescription[i5].isChronicPrescription,tempprescription.isSchedule=!1,tempprescription.isScheduleCorrection=!1,tempprescription.modelType=json_orderdetail.result.FreqOrderPrescription[i5].modelType,tempprescription.ownExpenseSeq=json_orderdetail.result.FreqOrderPrescription[i5].ownExpenseSeq,tempprescription.prescriptionId=json_orderdetail.result.FreqOrderPrescription[i5].prescriptionId,tempprescription.prescriptionModel=json_orderdetail.result.FreqOrderPrescription[i5].prescriptionModel,tempprescription.qty=json_orderdetail.result.FreqOrderPrescription[i5].qty,json_visittype.result[n.selectedIndex].isApplicable?tempprescription.selfPayType=json_orderdetail.result.FreqOrderPrescription[i5].selfPayType:(selfPayType=json_orderdetail.result.FreqOrderPrescription[i5].selfPayType,"*"==selfPayType||"#"==selfPayType?tempprescription.selfPayType=json_orderdetail.result.FreqOrderPrescription[i5].selfPayType:tempprescription.selfPayType="*"),tempprescription.startTime="",tempprescription.testPackageCode=json_orderdetail.result.FreqOrderPrescription[i5].testPackageCode,tempprescription.testPackageId=json_orderdetail.result.FreqOrderPrescription[i5].testPackageId,tempprescription.testPackageName=json_orderdetail.result.FreqOrderPrescription[i5].testPackageName,json_orderdetail.result.FreqOrderPrescription[i5].totalQty<1?tempprescription.totalQty=1:tempprescription.totalQty=json_orderdetail.result.FreqOrderPrescription[i5].totalQty,forinjectdate.prescriptions.push(tempprescription);forinjectdate.pulse=1*jres_health_records.result.pulse,forinjectdate.registrationDate=jres_registrations.result.date,forinjectdate.registrationId=jres_registrations.result.registrationId,forinjectdate.sbp=jres_registrations.result.sbp,forinjectdate.scheduleTest=null,forinjectdate.scheduleTestId=null,forinjectdate.shareCode=jres_registrations.result.shareCode,forinjectdate.shareId=jres_registrations.result.shareId,forinjectdate.supplyReportType=jres_health_records.result.supplyReportType,forinjectdate.transferClinicCode=jres_health_records.result.transferClinicCode,forinjectdate.treatmentEndDate=jres_registrations.result.date,forinjectdate.treatmentTypeId=jres_registrations.result.treatmentTypeId,forinjectdate.visitTypeCode=jres_registrations.result.visitTypeCode,forinjectdate.visitTypeId=jres_registrations.result.visitTypeId,forinjectdate.waist=null,forinjectdate.weight=1*jres_health_records.result.weight,forinjectdate.writeICCard=jres_registrations.result.isCardCheck,forinjectdates=JSON.stringify(forinjectdate),url_check_valid="https://phpcis.chshb.gov.tw/api/v1/health_records/check_valid",xmlHttp=new XMLHttpRequest,xmlHttp.open("POST",url_check_valid,!1),xmlHttp.setRequestHeader("Content-Type","application/json; charset=utf-8"),xmlHttp.send(forinjectdates),res_check_valid=xmlHttp.responseText,jres_check_valid=JSON.parse(res_check_valid),200==jres_check_valid.code?(url_update="https://phpcis.chshb.gov.tw/api/v1/health_records/update",xmlHttp=new XMLHttpRequest,xmlHttp.open("POST",url_update,!1),xmlHttp.setRequestHeader("Content-Type","application/json; charset=utf-8"),xmlHttp.send(forinjectdates),res_update=xmlHttp.responseText,jres_update=JSON.parse(res_update),200!=jres_update.code&&(errmsg=errmsg+"update錯誤，ID:"+registrationId+":"+jres3.message+"\n")):errmsg=errmsg+"valid錯誤，ID:"+registrationId+":"+jres_check_valid.message+"\n"}""==errmsg?(alert("完成"+array_patient.length+"筆"),changeevent=new Event("change",{bubbles:!0}),document.getElementsByClassName("form-control ampInput")[2].dispatchEvent(changeevent)):alert(errmsg)}function u(){document.getElementById("myDraggable_2").remove()}function m(){if(url_orderdetail="https://phpcis.chshb.gov.tw/api/v1/freq_orders/find?clinicId=4&freqOrderId="+s.value,xmlHttp=new XMLHttpRequest,xmlHttp.open("GET",url_orderdetail,!1),xmlHttp.send(),res_orderdetail=xmlHttp.responseText,json_orderdetail=JSON.parse(res_orderdetail),json_orderdetail.result.diseases.length>0?diagnosis=json_orderdetail.result.diseases[0].ICD10Code+" : "+json_orderdetail.result.diseases[0].ICD10Name:diagnosis="無",orderall="",json_orderdetail.result.FreqOrderPrescription.length>0)for(i6=0;i6<json_orderdetail.result.FreqOrderPrescription.length;i6++)neworder=json_orderdetail.result.FreqOrderPrescription[i6].applicationId+"_"+json_orderdetail.result.FreqOrderPrescription[i6].prescriptionName,""==orderall?orderall+=neworder:orderall=orderall+";"+neworder;else orderall="無";a.textContent="主診斷:"+diagnosis,c.textContent="處方:"+orderall}function h(t){posX=mouseX-t.clientX,posY=mouseY-t.clientY,mouseX=t.clientX,mouseY=t.clientY,e.style.left=e.offsetLeft-posX+"px",e.style.top=e.offsetTop-posY+"px"}function b(){document.removeEventListener("mousemove",h),document.removeEventListener("mouseup",b)}c.id="line4",c.textContent="處方:",e.appendChild(c),m()}ccc=document.URL,"https://phpcis.chshb.gov.tw/populanceRegistration"==ccc?(url_visittype="https://phpcis.chshb.gov.tw/api/v1/visit_types/list_visibility",xmlHttp=new XMLHttpRequest,xmlHttp.open("GET",url_visittype,!1),xmlHttp.send(),res_visittype=xmlHttp.responseText,json_visittype=JSON.parse(res_visittype),visittypelist={},url_freq_orders="https://phpcis.chshb.gov.tw/api/v1/freq_orders/list",xmlHttp=new XMLHttpRequest,xmlHttp.open("GET",url_freq_orders,!1),xmlHttp.send(),res_freq_orders=xmlHttp.responseText,json_freq_orders=JSON.parse(res_freq_orders),document.getElementById("myDraggable_2")?(document.getElementById("myDraggable_2").remove(),e()):e()):alert("需在候診患者查詢使用")}function H(){if(cc=document.URL,d1="https://phpcis.chshb.gov.tw/registration/create",d2="https://phpcis.chshb.gov.tw/registration",changeevent=new Event("change",{bubbles:!0}),alllist=[],cc.includes("https://phpcis.chshb.gov.tw"))if(thecode=document.getElementById("input_fasttype").value,""!=thecode)if(cc!=d2){if(cc==d1)alllist=document.getElementsByClassName("form-control ampInput"),age=(new Date).getFullYear()-1911-document.getElementsByClassName("form-control ampInput")[2].value.split("-")[0],popup=document.getElementsByClassName("modal-content"),popup.length>0&&(popup[1]&&popup[1].getElementsByClassName("btn btn-secondary")[0].click(),popup[0]&&popup[0].getElementsByClassName("col-xl-1 col-lg-1")[0].children[0].click());else for(sidebarlist=document.getElementsByClassName("sidebar__nav")[0].children,i=0;i<sidebarlist.length;i++)if("掛號"==sidebarlist[i].textContent){sidebarlist[i].click();break}for(find=!1,i=0;i<alllist.length;i++)"visitTypeId"==alllist[i].id?(targetelement=alllist[i],find=!0):"prevention"==alllist[i].name?targetelement2=alllist[i]:"preventionId"==alllist[i].name&&(targetelement3=alllist[i]);if(find){if(thecode=thecode.toString(),"691"==thecode)if(cc==d1){for(i=0;i<targetelement.options.length;i++)if(targetelement.options[i].text.includes("69")){targetelement.options[i].selected=!0,targetelement.dispatchEvent(changeevent);break}targetelement2.value="02",targetelement2.dispatchEvent(changeevent),age>64?(targetelement3.value="10",targetelement3.dispatchEvent(changeevent)):(targetelement3.value="8",targetelement3.dispatchEvent(changeevent))}else alert("請在新增掛號時使用");else if("692"==thecode)if(cc==d1){for(i=0;i<targetelement.options.length;i++)if(targetelement.options[i].text.includes("69")){targetelement.options[i].selected=!0,targetelement.dispatchEvent(changeevent);break}targetelement2.value="02",targetelement2.dispatchEvent(changeevent),age>64?(targetelement3.value="11",targetelement3.dispatchEvent(changeevent)):(targetelement3.value="9",targetelement3.dispatchEvent(changeevent))}else alert("請在新增掛號時使用");else for(i=0;i<targetelement.options.length;i++)if(targetelement.options[i].text.includes(thecode)){targetelement.options[i].selected=!0,targetelement.dispatchEvent(changeevent);break}document.getElementsByClassName("ampRegistationBtn btn btn-danger")[0].click()}}else document.getElementsByClassName("commonBtn ampCommonBtn btn btn-info")[0].click();else alert("未輸入身分別");else alert("請在PHPCIIS網域中使用")}function O(){if(ccc=document.URL,ccc.includes("https://phpcis.chshb.gov.tw")){vaccinelist={J000151206:"高端",J000138206:"國光",K001036206:"賽諾菲",K001126206:"東洋",K000906206:"PCV13",K000492206:"PPV23"},Url="https://phpcis.chshb.gov.tw/api/v1/clinics/settings/find",xmlHttp=new XMLHttpRequest,xmlHttp.open("GET",Url,!1),xmlHttp.send(),res=xmlHttp.responseText;try{jres=JSON.parse(res),msg="流感疫苗廠牌",msg=msg+"\n\t一般:"+vaccinelist[jres.result.influenzaId],msg=msg+"\n\t3-"+jres.result.influenzaAgeN+"歲:"+vaccinelist[jres.result.influenzaCode3toN],msg=msg+"\n\t<3歲:"+vaccinelist[jres.result.influenzaCodeUnder3Id],msg=msg+"\n\t縣購:"+vaccinelist[jres.result.freeInfluenzaVaccineApplicationId],msg+="\n肺炎鏈球菌疫苗廠牌:",msg=msg+"\n\t65歲PPV:"+vaccinelist[jres.result.pneumoniaCode],msg=msg+"\n\t65歲PCV:"+vaccinelist[jres.result.pneumonia13PCVCode],msg=msg+"\n\t縣購:"+vaccinelist[jres.result.freePneumoniaVaccineApplicationId],msg+="\n是否需修改?",confirmact=confirm(msg),confirmact&&window.open("https://phpcis.chshb.gov.tw/healthCenterSetting")}catch(e){alert("出錯了，可能未登入")}}else alert("請在PHPCIIS內使用")}function M(){if(ccc=document.URL,d2="https://phpcis.chshb.gov.tw/registration",ccc==d2)if(t6z=0,t6f=0,t6v=0,t7w=0,t7z=0,t7y=0,t7z=0,t7t=0,sb=document.querySelector("table"),sb.textContent.includes("無資料"))alert("無掛號");else{for(i=0;i<sb.rows[0].cells.length;i++)"身分證號"==sb.rows[0].cells[i].innerText&&(theidc=i),"姓名"==sb.rows[0].cells[i].innerText&&(thenamec=i),"身分"==sb.rows[0].cells[i].innerText&&(thetypec=i);for(i=1;i<sb.rows.length;i++)sb.rows[i].cells[thetypec].textContent.includes("6Z")?t6z+=1:sb.rows[i].cells[thetypec].textContent.includes("6F")?t6f+=1:sb.rows[i].cells[thetypec].textContent.includes("6V")?t6v+=1:sb.rows[i].cells[thetypec].textContent.includes("6Z")?t6z+=1:sb.rows[i].cells[thetypec].textContent.includes("7T")?t7t+=1:sb.rows[i].cells[thetypec].textContent.includes("7W")?t7w+=1:sb.rows[i].cells[thetypec].textContent.includes("7X")?t7y+=1:sb.rows[i].cells[thetypec].textContent.includes("7Y")?t7y+=1:sb.rows[i].cells[thetypec].textContent.includes("7Z")&&(t7z+=1);fall=t6z+t7w+t7z,jjjj="流感共"+fall+"支，含\n\t公費流感:"+t6z+"支\n\t流感學生:"+t7w+"支\n\t縣購流感:"+t7z+"支\n公費PCV13:"+t6f+"支\n公費PPV23:"+t6v+"支\n縣購肺鏈:"+t7y+"支\n新冠疫苗"+t7t+"支",alert(jjjj)}else alert("請在掛號列表中使用")}function q(){function e(e){if(tb=document.getElementsByClassName("table table-striped table-bordered table-sm role-list__role-table commonTable")[e],array_patient=[],tb.rows[1].cells.length>2)for(let e=1;e<tb.rows.length;e++)tb.rows[e].cells[0].children[0].checked&&(href=tb.rows[e].cells[4].children[0].href.split("/"),p_name=tb.rows[e].cells[4].textContent,p_visittype=tb.rows[e].cells[7].textContent,registrationId=href[href.length-1],array_patient.push(registrationId));return 1==array_patient.length&&array_patient[0]}function t(e){return period=document.getElementById("period").value,shiftId=document.getElementById("shiftId").value,url="https://phpcis.chshb.gov.tw/api/v1/registrations/find?registrationId="+e,xmlHttp.open("GET",url,!1),xmlHttp.send(),res=xmlHttp.responseText,jres=JSON.parse(res),jres}function n(e){payload={},payload.registrationId=1*e,payloads=JSON.stringify(payload),delurl="https://phpcis.chshb.gov.tw/api/v1/registrations/delete",xmlHttp.open("POST",delurl,!1),xmlHttp.setRequestHeader("Content-Type","application/json; charset=utf-8"),xmlHttp.send(payloads),delres=xmlHttp.responseText,jdelres=JSON.parse(delres),200==jdelres.code?alert("刪除成功"):alert(jdelres.message)}function i(e){payload={},payload.date=e.result.date,payload.healthRecordId=e.result.healthRecordId,payload.period=e.result.period,payload.shiftId=e.result.shiftId,payloads=JSON.stringify(payload),delurl="https://phpcis.chshb.gov.tw/api/v1/health_records/delete",xmlHttp.open("POST",delurl,!1),xmlHttp.setRequestHeader("Content-Type","application/json; charset=utf-8"),xmlHttp.send(payloads),delres=xmlHttp.responseText,jdelres=JSON.parse(delres),200==jdelres.code?alert("刪除成功"):alert(jdelres.message)}function r(){changeevent=new Event("change",{bubbles:!0}),document.getElementById("shiftId").dispatchEvent(changeevent)}ccc=document.URL,"https://phpcis.chshb.gov.tw/populanceRegistration"==ccc?(xmlHttp=new XMLHttpRequest,"true"==document.getElementById("uncontrolled-tab-example-tab-consulted").getAttribute("aria-selected")?(registrationId=e(1),registrationId?(jres=t(registrationId),ans=confirm("姓名:"+jres.result.name+"\n身分證:"+jres.result.personalId+"\n身分代碼:"+jres.result.visitTypeCode+"\n是否刪除看診紀錄?"),ans&&(i(jres),r())):alert("無選擇個案")):(registrationId=e(0),registrationId?(jres=t(registrationId),ans=confirm("姓名:"+jres.result.name+"\n身分證:"+jres.result.personalId+"\n身分代碼:"+jres.result.visitTypeCode+"\n是否刪除掛號紀錄?"),ans&&(n(registrationId),r())):alert("無選擇個案"))):alert("需到候診患者查詢頁面")}async function R(){uuu=document.URL,mode="","https://phpcis.chshb.gov.tw/populanceRegistration"==uuu?(shiftId=document.getElementById("shiftId").value,mode="OPD"):"https://phpcis.chshb.gov.tw/registration"==uuu?(shiftId=document.getElementsByName("period")[1].value,mode="REG"):alert("非掛號資訊列表或候診患者查詢"),""!=mode&&await fetch("https://phpcis.chshb.gov.tw/api/v1/registrations/list?clinicId=4&shiftId="+shiftId,{headers:{"content-type":"application/json"},body:null,method:"GET"}).then(e=>e.text()).then(e=>{if("OPD"==mode?ttt=document.getElementsByClassName("table table-striped table-bordered table-sm role-list__role-table commonTable"):"REG"==mode&&(ttt=document.getElementsByClassName("table table-striped table-bordered table-sm commonTable ampTableFontSize")),ccc=JSON.parse(e),alllist={},"病歷號(新)"==ttt[0].rows[0].cells[2].textContent){for(i=0;i<ccc.result.length;i++)alllist[ccc.result[i].personalId]=ccc.result[i].recordNo;if(ttt[0].rows[0].cells[2].innerHTML="病歷號(舊)<span class='order-4'></span>","無資料"!=ttt[0].rows[1].textContent)for(i=1;i<ttt[0].rows.length;i++)ttt[0].rows[i].cells[2].textContent=alllist[ttt[0].rows[i].cells[3].textContent];if("OPD"==mode&&(ttt[1].rows[0].cells[2].innerHTML="病歷號(舊)<span class='order-4'></span>","無資料"!=ttt[1].rows[1].textContent))for(i=1;i<ttt[1].rows.length;i++)ttt[1].rows[i].cells[2].textContent=alllist[ttt[1].rows[i].cells[3].textContent]}else{for(i=0;i<ccc.result.length;i++)alllist[ccc.result[i].personalId]=ccc.result[i].bureauRecordNo;if(ttt[0].rows[0].cells[2].innerHTML="病歷號(新)<span class='order-4'></span>","無資料"!=ttt[0].rows[1].textContent)for(i=1;i<ttt[0].rows.length;i++)ttt[0].rows[i].cells[2].textContent=alllist[ttt[0].rows[i].cells[3].textContent];if("OPD"==mode&&(ttt[1].rows[0].cells[2].textContent="病歷號(新)","無資料"!=ttt[1].rows[1].textContent))for(i=1;i<ttt[1].rows.length;i++)ttt[1].rows[i].cells[2].textContent=alllist[ttt[1].rows[i].cells[3].textContent]}})}function B(){if(ccc=document.URL,d1="https://phpcis.chshb.gov.tw/registration",d2="https://phpcis.chshb.gov.tw/registration/create",d3="https://phpcis.chshb.gov.tw/registration/",ccc==d1)if(tb=document.getElementsByClassName("table table-striped table-bordered table-sm commonTable ampTableFontSize")[0],tb.textContent.includes("無資料"))alert("無個案");else{for(theindex=!1,i=1;i<tb.rows.length;i++)if(tb.rows[i].cells[0].children[0].checked){theindex=i;break}theindex?(bureauRecordNo=tb.rows[theindex].cells[2].textContent,xmlHttp=new XMLHttpRequest,Url="https://phpcis.chshb.gov.tw/api/v1/personal_infos/list?bureauRecordNo="+bureauRecordNo,xmlHttp.open("GET",Url,!1),xmlHttp.setRequestHeader("Content-Type","application/json; charset=UTF-8"),xmlHttp.send(),uuu=xmlHttp.responseText,uuujson=JSON.parse(uuu),personalInfoId=uuujson.result[0].personalInfoId,window.open("https://phpcis.chshb.gov.tw/case/"+personalInfoId,"_blank")):alert("無選擇個案")}else ccc==d2||ccc.includes(d3)?(bureauRecordNo=document.getElementsByName("bureauRecordNo")[0].value,null!=bureauRecordNo&&""!=bureauRecordNo&&(xmlHttp=new XMLHttpRequest,Url="https://phpcis.chshb.gov.tw/api/v1/personal_infos/list?bureauRecordNo="+bureauRecordNo,xmlHttp.open("GET",Url,!1),xmlHttp.setRequestHeader("Content-Type","application/json; charset=UTF-8"),xmlHttp.send(),uuu=xmlHttp.responseText,uuujson=JSON.parse(uuu),personalInfoId=uuujson.result[0].personalInfoId,window.open("https://phpcis.chshb.gov.tw/case/"+personalInfoId,"_blank"))):alert("請在掛號資訊列表使用")}async function A(){if(countlimit=10,url=document.URL,d0="https://phpcis.chshb.gov.tw/registration/create",d1="https://phpcis.chshb.gov.tw/registration/",d2="https://phpcis.chshb.gov.tw/registration",url==d0||url.includes(d1))theID=document.getElementsByClassName("form-control ampInput")[1].value,thename=document.getElementsByClassName("form-control ampInput")[0].value,url="https://phpcis.chshb.gov.tw/api/v1/registrations/list?personalId="+theID,await fetch(url,{headers:{"content-type":"application/json"},body:null,method:"GET"}).then(e=>e.text()).then(t=>{for(res=JSON.parse(t),count=0,msg="",i=0;i<res.result.length;i++)count<countlimit&&"1"==res.result[i].treatmentStatus&&(msg=msg+"日期:"+e(res.result[i].treatmentDate)+",類別:"+res.result[i].visitTypeCode+res.result[i].visitType+",就醫序號:"+res.result[i].treatmentSeqNo+"\n",count+=1);0==count?alert("該個案無已完成就診紀錄"):(msg="個案 "+thename+" 最近 "+count+" 次完成就診紀錄\n"+msg,alert(msg))}).catch(e=>console.log(e));else if(url==d2)if(tb=document.querySelector("table"),tb.textContent.includes("無資料"))alert("無掛號資料");else{for(theID="",i=1;i<tb.rows.length;i++)if(tb.rows[i].cells[0].children[0].checked){theID=tb.rows[i].cells[3].textContent,thename=tb.rows[i].cells[4].textContent;break}""==theID?alert("未選擇個案"):(url="https://phpcis.chshb.gov.tw/api/v1/registrations/list?personalId="+theID,await fetch(url,{headers:{"content-type":"application/json"},body:null,method:"GET"}).then(e=>e.text()).then(t=>{for(res=JSON.parse(t),count=0,msg="",i=0;i<res.result.length;i++)count<countlimit&&"1"==res.result[i].treatmentStatus&&(msg=msg+"日期:"+e(res.result[i].treatmentDate)+",類別:"+res.result[i].visitTypeCode+res.result[i].visitType+",就醫序號:"+res.result[i].treatmentSeqNo+"\n",count+=1);0==count?alert("該個案無已完成就診紀錄"):(msg="個案 "+thename+" 最近 "+count+" 次完成就診紀錄\n"+msg,alert(msg))}).catch(e=>console.log(e)))}else alert("請在新增掛號資料或編輯掛號資料時使用");function e(e){return yy=e.split("-")[0]-1911,mm=e.split("-")[1],dd=e.split("-")[2],mky=yy+mm+dd,mky}}async function F(){if(tu=document.URL,wu="https://phpcis.chshb.gov.tw/familyMedicine",tu==wu)if(tb=document.querySelector("#uncontrolled-tab-example-tabpane-02 > div > div.line > div > table"),null==tb)alert("發生錯誤");else if(tb.textContent.includes("無資料"))changeevent=new Event("change",{bubbles:!0}),document.querySelector("#uncontrolled-tab-example-tab-02").click(),pan=document.getElementById("uncontrolled-tab-example-tabpane-02"),sel=pan.getElementsByClassName("form-control ampInput"),sel[0].options[3].selected=!0,sel[0].dispatchEvent(changeevent),sel[1].options[1].selected=!0,sel[1].dispatchEvent(changeevent),sel[2].options[1].selected=!0,sel[2].dispatchEvent(changeevent),tb.rows[0].cells[1].children[0].click(),pan.getElementsByClassName("ampCommonBtn btn btn-primary")[0].click();else{if(!("showOpenFilePicker"in self))throw Error("unsupported browser");try{for(txtopt={types:[{description:"醫療群上傳檔案",accept:{"TXT/*":[".txt"]}}],excludeAcceptAllOption:!0,multiple:!1},handles=await showOpenFilePicker(txtopt),file=await handles[0].getFile(),txtar=await file.arrayBuffer(),txtcon=new TextDecoder("big5").decode(txtar),a_txtcon=txtcon.split("\r\n"),csvopt={types:[{description:"健保局回饋錯誤檔",accept:{"CSV/*":[".csv"]}}],excludeAcceptAllOption:!0,multiple:!1},handles=await showOpenFilePicker(csvopt),file=await handles[0].getFile(),csvar=await file.arrayBuffer(),csvcon=new TextDecoder("big5").decode(csvar),csvcon=csvcon.replaceAll("'",""),csvcon=csvcon.replaceAll('"',""),a_csvcon=csvcon.split("\r\n"),list=[],i=1;i<a_csvcon.length-1;i++)temp=a_csvcon[i].split(",")[0],temp=a_txtcon[temp-1].substring(14,24),list.push(temp);for(i=0;i<list.length;i++)for(LID=list[i],find=0,j=1;j<tb.rows.length;j++)if(TID=tb.rows[j].cells[1].innerText,LID==TID){tb.rows[j].style.backgroundColor="#82D900";break}tb.rows[0].cells[1].children[0].click(),alert("完成，請對綠色欄位點選失效")}catch(e){alert("錯誤，請選擇正確的檔案")}}else confirm("非家醫計畫作業頁面,是否跳轉業面?")&&gotourl("/familyMedicine")}function X(){if(ccc=document.URL,"https://phpcis.chshb.gov.tw/populanceRegistration"==ccc){for(smokefuid="",smokefu=["E1023C","E1024C","E1025C","E1026C","E1028C","E1029C"],url_visittype="https://phpcis.chshb.gov.tw/api/v1/visit_types/list_visibility",xmlHttp=new XMLHttpRequest,xmlHttp.open("GET",url_visittype,!1),xmlHttp.send(),res_visittype=xmlHttp.responseText,json_visittype=JSON.parse(res_visittype),transvisittype={},zz=0;zz<json_visittype.result.length;zz++)transvisittype[json_visittype.result[zz].visitTypeCode]=json_visittype.result[zz].isApplicable;url_freq_orders="https://phpcis.chshb.gov.tw/api/v1/freq_orders/list",xmlHttp=new XMLHttpRequest,xmlHttp.open("GET",url_freq_orders,!1),xmlHttp.send(),res_freq_orders=xmlHttp.responseText,json_freq_orders=JSON.parse(res_freq_orders),document.getElementById("myDraggable_3")?(document.getElementById("myDraggable_3").remove(),e()):e()}else alert("需在候診患者查詢使用");function e(){var e=document.createElement("div");e.id="myDraggable_3",e.style.width="450px",e.style.background="#f9f9f9",e.style.border="1px solid #ccc",e.style.position="absolute",e.style.cursor="move",e.style.zIndex="9999",e.style.left=Math.ceil(window.innerWidth/2-225)+"px",e.style.top="300px",document.body.insertBefore(e,document.body.firstChild),e.addEventListener("mousedown",function(e){mouseX=e.clientX,mouseY=e.clientY,document.addEventListener("mousemove",p),document.addEventListener("mouseup",u)});var t=document.createElement("div");t.textContent="標準處方",t.style.height="30px",e.appendChild(t);var n=document.createElement("select");for(n.style.height="30px",n.id="ordercombo",n.style.width="250px",i2=0;i2<json_freq_orders.result.length;i2++)newOption=document.createElement("option"),freqOrderCode=json_freq_orders.result[i2].freqOrderCode,freqOrderName=json_freq_orders.result[i2].freqOrderName,freqOrderId=json_freq_orders.result[i2].freqOrderId,newOption.text=freqOrderCode+" : "+freqOrderName,newOption.value=freqOrderId,n.appendChild(newOption);t.appendChild(n),n.addEventListener("change",d);var i=document.createElement("button");i.id="confirmbutton",i.textContent="帶入處方",i.style.height="30px",i.style.left="315px",i.style.position="absolute",i.addEventListener("click",s),t.appendChild(i);var r=document.createElement("button");r.id="exitbutton",r.textContent="關閉",r.style.height="30px",r.style.left="398px",r.style.position="absolute",r.addEventListener("click",c),t.appendChild(r);var l=document.createElement("div");l.id="line3",l.textContent="主診斷:",e.appendChild(l);var o=document.createElement("div");function s(){if(tb=document.getElementsByClassName("table table-striped table-bordered table-sm role-list__role-table commonTable")[0],array_patient=[],tb.rows[1].cells.length>2)for(i9=1;i9<tb.rows.length;i9++)tb.rows[i9].cells[0].children[0].checked&&(href=tb.rows[i9].cells[4].children[0].href.split("/"),p_name=tb.rows[i9].cells[4].textContent,p_visittype=tb.rows[i9].cells[7].textContent,registrationId=href[href.length-1],array_patient.push(registrationId));if(1==array_patient.length)if(json_orderdetail.result.diseases.length>0)if(json_orderdetail.result.FreqOrderPrescription.length>0){hadsmokefu=!1;for(let e=0;e<json_orderdetail.result.FreqOrderPrescription.length;e++)if(smokefu.includes(json_orderdetail.result.FreqOrderPrescription[e].applicationId)){hadsmokefu=!0;break}confirm("是否將處方帶入個案"+p_name+"，身分別:"+p_visittype+"?")&&(hadsmokefu&&(smokefuid=prompt("請輸入戒菸追蹤人員ID",smokefuid)),a())}else alert("該標準處方無處置");else alert("該標準處方無診斷");else alert("無選擇個案")}function a(){for(errmsg="",i3=0;i3<array_patient.length;i3++){for(registrationId=array_patient[i3],url_registrationId="https://phpcis.chshb.gov.tw/api/v1/registrations/find?registrationId="+registrationId,xmlHttp=new XMLHttpRequest,xmlHttp.open("GET",url_registrationId,!1),xmlHttp.send(),res_registrations=xmlHttp.responseText,jres_registrations=JSON.parse(res_registrations),url_health_records="https://phpcis.chshb.gov.tw/api/v1/health_records/find?registrationId="+registrationId,xmlHttp=new XMLHttpRequest,xmlHttp.open("GET",url_health_records,!1),xmlHttp.send(),res_health_records=xmlHttp.responseText,jres_health_records=JSON.parse(res_health_records),forinjectdate={},forinjectdate.CC=json_orderdetail.result.CC,forinjectdate.PE=json_orderdetail.result.PE,forinjectdate.abnormalTreatmentSeqNo=null,forinjectdate.benefitTypeCode=jres_registrations.result.benefitTypeCode,forinjectdate.benefitTypeId=jres_registrations.result.benefitTypeId,forinjectdate.bmi=1*jres_health_records.result.bmi,16==jres_registrations.result.caseTypeId?(forinjectdate.caseTypeId=23,forinjectdate.caseTypeCode="09"):(forinjectdate.caseTypeId=jres_registrations.result.caseTypeId,forinjectdate.caseTypeCode=jres_registrations.result.caseTypeCode),forinjectdate.caseTypeId=jres_registrations.result.caseTypeId,forinjectdate.clinicId=json_freq_orders.result[0].clinicId,forinjectdate.codContent=jres_health_records.result.codContent,forinjectdate.courseHealthRecordId=jres_health_records.result.courseHealthRecordId,forinjectdate.dbp=1*jres_health_records.result.dbp,forinjectdate.diseases=[],i4=0;i4<json_orderdetail.result.diseases.length;i4++)tempdisease={},tempdisease.ICD10Code=json_orderdetail.result.diseases[i4].ICD10Code,tempdisease.diseaseId=json_orderdetail.result.diseases[i4].diseaseId,tempdisease.isChronic=json_orderdetail.result.diseases[i4].isChronic,0==i4?tempdisease.isMaster=!0:tempdisease.isMaster=!1,forinjectdate.diseases.push(tempdisease);for(forinjectdate.dispensingType=null,forinjectdate.glucoseAC=1*jres_health_records.result.glucoseAC,forinjectdate.glucosePC=1*jres_health_records.result.glucosePC,forinjectdate.healthRecordId=jres_health_records.result.healthRecordId,forinjectdate.height=1*jres_health_records.result.height,forinjectdate.homeCareType=jres_health_records.result.homeCareType,forinjectdate.isAutoCorrect=jres_health_records.result.isAutoCorrect,forinjectdate.isChronicPrescription=jres_health_records.result.isChronicPrescription,forinjectdate.isEmergencyVisit=jres_health_records.result.isEmergencyVisit,forinjectdate.isIncludeFamilyCare=jres_health_records.result.isIncludeFamilyCare,forinjectdate.isICCardWritten=jres_registrations.result.isICCard,forinjectdate.personalInfoId=jres_health_records.result.personalInfoId,forinjectdate.physicalExamHistoryId=jres_health_records.result.physicalExamHistoryId,forinjectdate.prescriptionDeadline=jres_health_records.result.prescriptionDeadline,forinjectdate.prescriptionNo=jres_health_records.result.prescriptionNo,forinjectdate.prescriptionReuseTimes=jres_health_records.result.prescriptionReuseTimes,forinjectdate.prescriptionType=jres_health_records.result.prescriptionType,forinjectdate.prescriptions=[],i5=0;i5<json_orderdetail.result.FreqOrderPrescription.length;i5++)tempprescription={},smokefu.includes(json_orderdetail.result.FreqOrderPrescription[i5].applicationId)&&""!=smokefuid&&null!=smokefuid&&(tempprescription.doctorVisitRemark=smokefuid),tempprescription.bureauTestCode=json_orderdetail.result.FreqOrderPrescription[i5].bureauTestCode,tempprescription.day=json_orderdetail.result.FreqOrderPrescription[i5].day,tempprescription.description="",tempprescription.drugCode=json_orderdetail.result.FreqOrderPrescription[i5].prescriptionCode,tempprescription.drugName=json_orderdetail.result.FreqOrderPrescription[i5].prescriptionName,tempprescription.drugRouteId=json_orderdetail.result.FreqOrderPrescription[i5].drugRouteId,tempprescription.drugUsageId=json_orderdetail.result.FreqOrderPrescription[i5].drugUsageId,tempprescription.endTime=null,tempprescription.isApplicable=json_orderdetail.result.FreqOrderPrescription[i5].isApplicable,tempprescription.isChronicPrescription=json_orderdetail.result.FreqOrderPrescription[i5].isChronicPrescription,tempprescription.isSchedule=!1,tempprescription.isScheduleCorrection=!1,tempprescription.modelType=json_orderdetail.result.FreqOrderPrescription[i5].modelType,tempprescription.ownExpenseSeq=json_orderdetail.result.FreqOrderPrescription[i5].ownExpenseSeq,tempprescription.prescriptionId=json_orderdetail.result.FreqOrderPrescription[i5].prescriptionId,tempprescription.prescriptionModel=json_orderdetail.result.FreqOrderPrescription[i5].prescriptionModel,tempprescription.qty=json_orderdetail.result.FreqOrderPrescription[i5].qty,transvisittype[jres_registrations.result.visitTypeCode]?tempprescription.selfPayType=json_orderdetail.result.FreqOrderPrescription[i5].selfPayType:(selfPayType=json_orderdetail.result.FreqOrderPrescription[i5].selfPayType,"*"==selfPayType||"#"==selfPayType?tempprescription.selfPayType=json_orderdetail.result.FreqOrderPrescription[i5].selfPayType:tempprescription.selfPayType="*"),tempprescription.startTime="",tempprescription.testPackageCode=json_orderdetail.result.FreqOrderPrescription[i5].testPackageCode,tempprescription.testPackageId=json_orderdetail.result.FreqOrderPrescription[i5].testPackageId,tempprescription.testPackageName=json_orderdetail.result.FreqOrderPrescription[i5].testPackageName,json_orderdetail.result.FreqOrderPrescription[i5].totalQty<1?tempprescription.totalQty=1:tempprescription.totalQty=json_orderdetail.result.FreqOrderPrescription[i5].totalQty,forinjectdate.prescriptions.push(tempprescription);forinjectdate.pulse=1*jres_health_records.result.pulse,forinjectdate.registrationDate=jres_registrations.result.date,forinjectdate.registrationId=jres_registrations.result.registrationId,forinjectdate.sbp=jres_registrations.result.sbp,forinjectdate.scheduleTest=null,forinjectdate.scheduleTestId=null,forinjectdate.shareCode=jres_registrations.result.shareCode,forinjectdate.shareId=jres_registrations.result.shareId,forinjectdate.supplyReportType=jres_health_records.result.supplyReportType,forinjectdate.transferClinicCode=jres_health_records.result.transferClinicCode,forinjectdate.treatmentEndDate=jres_registrations.result.date,forinjectdate.treatmentTypeId=jres_registrations.result.treatmentTypeId,forinjectdate.visitTypeCode=jres_registrations.result.visitTypeCode,forinjectdate.visitTypeId=jres_registrations.result.visitTypeId,forinjectdate.waist=null,forinjectdate.weight=1*jres_health_records.result.weight,forinjectdate.writeICCard=jres_registrations.result.isCardCheck,forinjectdates=JSON.stringify(forinjectdate),url_check_valid="https://phpcis.chshb.gov.tw/api/v1/health_records/check_valid",xmlHttp=new XMLHttpRequest,xmlHttp.open("POST",url_check_valid,!1),xmlHttp.setRequestHeader("Content-Type","application/json; charset=utf-8"),xmlHttp.send(forinjectdates),res_check_valid=xmlHttp.responseText,jres_check_valid=JSON.parse(res_check_valid),200==jres_check_valid.code?(url_update="https://phpcis.chshb.gov.tw/api/v1/health_records/update",xmlHttp=new XMLHttpRequest,xmlHttp.open("POST",url_update,!1),xmlHttp.setRequestHeader("Content-Type","application/json; charset=utf-8"),xmlHttp.send(forinjectdates),res_update=xmlHttp.responseText,jres_update=JSON.parse(res_update),200!=jres_update.code&&(errmsg=errmsg+"update錯誤，ID:"+registrationId+":"+jres3.message+"\n")):errmsg=errmsg+"valid錯誤，ID:"+registrationId+":"+jres_check_valid.message+"\n"}""==errmsg?(alert("標準處方帶入完成"),changeevent=new Event("change",{bubbles:!0}),document.getElementsByClassName("form-control ampInput")[2].dispatchEvent(changeevent)):alert(errmsg)}function c(){document.getElementById("myDraggable_3").remove()}function d(){if(url_orderdetail="https://phpcis.chshb.gov.tw/api/v1/freq_orders/find?clinicId=4&freqOrderId="+n.value,xmlHttp=new XMLHttpRequest,xmlHttp.open("GET",url_orderdetail,!1),xmlHttp.send(),res_orderdetail=xmlHttp.responseText,json_orderdetail=JSON.parse(res_orderdetail),json_orderdetail.result.diseases.length>0?diagnosis=json_orderdetail.result.diseases[0].ICD10Code+" : "+json_orderdetail.result.diseases[0].ICD10Name:diagnosis="無",orderall="",json_orderdetail.result.FreqOrderPrescription.length>0)for(i6=0;i6<json_orderdetail.result.FreqOrderPrescription.length;i6++)neworder=json_orderdetail.result.FreqOrderPrescription[i6].applicationId+"_"+json_orderdetail.result.FreqOrderPrescription[i6].prescriptionName,""==orderall?orderall+=neworder:orderall=orderall+";"+neworder;else orderall="無";l.textContent="主診斷:"+diagnosis,o.textContent="處方:"+orderall}function p(t){posX=mouseX-t.clientX,posY=mouseY-t.clientY,mouseX=t.clientX,mouseY=t.clientY,e.style.left=e.offsetLeft-posX+"px",e.style.top=e.offsetTop-posY+"px"}function u(){document.removeEventListener("mousemove",p),document.removeEventListener("mouseup",u)}o.id="line4",o.textContent="處方:",e.appendChild(o),d()}}function J(){if(ccc=document.URL,"https://phpcis.chshb.gov.tw/medicalRefee"==ccc){document.querySelectorAll("input")[0].style.background="#F9F900",nowarr=document.querySelectorAll("input")[0].value.split(" ")[1].split("-"),mky=""+(nowarr[0]-1911),mkm=nowarr[1],monthdocurl="https://phpcis.chshb.gov.tw/api/v1/applications/monthly/statistics/doctors/list?targetYearMonth="+mky+mkm,xmlHttp=new XMLHttpRequest,xmlHttp.open("GET",monthdocurl,!1),xmlHttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),xmlHttp.send(),res_monthdoc=xmlHttp.responseText,jres_monthdoc=JSON.parse(res_monthdoc),msg="",data=jres_monthdoc.result.data;for(let e=0;e<data.length;e++)ord=""+(e+1),msg+=ord+". "+data[e].doctorName+" : "+data[e].dateCount+" 天\n";""!=msg?msg="反黃月份("+mky+mkm+")進行查詢結果如下\n"+msg:msg="無看診醫師",alert(msg)}}function K(){if(ccc=document.URL,ccc.includes("https://phpcis.chshb.gov.tw/consultationMainPage/"))chn=document.querySelector("#root > div.wrapper > main > div > form > div:nth-child(1) > div:nth-child(12) > div").textContent,U(chn);else if("https://phpcis.chshb.gov.tw/populanceRegistration"==ccc||"https://phpcis.chshb.gov.tw/registration"==ccc){radiolist=document.querySelectorAll('input[type="radio"]'),targeturl="";for(let e=0;e<radiolist.length;e++)if(radiolist[e].checked&&radiolist[e].getBoundingClientRect().height>0){targeturl=radiolist[e].parentElement.parentElement.children[2].textContent;break}""!=targeturl?U(targeturl):alert("請選擇個案")}else(ccc.includes("https://phpcis.chshb.gov.tw/registration/")||"https://phpcis.chshb.gov.tw/registration/create"==ccc)&&("https://phpcis.chshb.gov.tw/registration/create"==ccc?chn=document.querySelector("#root > div.wrapper > main > div > form > div:nth-child(4) > div:nth-child(4) > div > div > input").value:chn=document.querySelector("#root > div.wrapper > main > div > form > div:nth-child(4) > div:nth-child(2) > div > div > input").value,U(chn))}function U(t){if(testmode=!1,personalinfoobj=G(t),personalinfoobj){vhurl="https://phpcis.chshb.gov.tw/api/v1/niis/vaccination_history/list?personalInfoId="+personalinfoobj.personalInfoId,retjson=JSON.parse(Y(vhurl)),ay=personalinfoobj.birthday.split("-"),gy="000"+(ay[0]-1911),patientidbirth=gy.substring(gy.length-3,gy.length)+ay[1]+ay[2],thename=personalinfoobj.name,resultobj={Record:[],ApplyRecord:[],VaccRecord:"",Error:""},tempobj={};for(let e=0;e<retjson.result.length;e++)injitem=retjson.result[e],injitem.immuDate in tempobj||(tempobj[injitem.immuDate]=[]),tempobj[injitem.immuDate].push(injitem);tempdatelist=Object.keys(tempobj),tempdatelist=tempdatelist.sort();for(let e=0;e<tempdatelist.length;e++){idhis=tempobj[tempdatelist[e]];for(let e=0;e<idhis.length;e++)immuDate=idhis[e].immuDate,theY=1*immuDate.substring(0,3)+1911,theM=immuDate.substring(3,5),theD=immuDate.substring(5,7),tempid={SRVC:idhis[e].vaccineID,ID:theY+"-"+theM+"-"+theD+"T00:00:00",ON:idhis[e].immuAgcyName,VB:""},resultobj.ApplyRecord.push(tempid)}vaccinelist=["rHepB-1","rHepB-2","rHepB-3","13PCV-1","13PCV-2","13PCV-3","13PCV-4","5in1-1","5in1-2","5in1-3","5in1-4","BCG","MMR-1","MMR-2","Var-1","2HepA-1","2HepA-2","JE-CV_LiveAtd-1","JE-CV_LiveAtd-2","DTaP-IPV-5"],vacnameprolist={BCG:["BCG"],"rHepB-1":["HBV"],"rHepB-2":["HBV"],"rHepB-3":["HBV"],"5in1-1":["Tetanus","Diphtheria","Pertusis","Polio","Hib"],"5in1-2":["Tetanus","Diphtheria","Pertusis","Polio","Hib"],"5in1-3":["Tetanus","Diphtheria","Pertusis","Polio","Hib"],"5in1-4":["Tetanus","Diphtheria","Pertusis","Polio","Hib"],"MMR-1":["Measles","Mumps","Rubella"],"MMR-2":["Measles","Mumps","Rubella"],"JE-1":["JE"],"JE-2":["JE"],"JE-3":["JE"],"JE-4":["JE"],"JE-CV_LiveAtd-1":["JE"],"JE-CV_LiveAtd-2":["JE"],"JE_LiveAtd-1":["JE"],"JE_LiveAtd-2":["JE"],"JE-VC_Inactd-1":["JE"],"JE-VC_Inactd-2":["JE"],"JE-VC_Inactd-3":["JE"],"JE-VC_Inactd-4":["JE"],"Tdap-IPV":["Tetanus","Diphtheria","Pertusis","Polio"],Td:["Tetanus","Diphtheria"],"2HepA-1":["HAV"],"2HepA-2":["HAV"],"6in1-1":["Tetanus","Diphtheria","Pertusis","Polio","Hib","HBV"],"6in1-2":["Tetanus","Diphtheria","Pertusis","Polio","Hib","HBV"],"6in1-3":["Tetanus","Diphtheria","Pertusis","Polio","Hib","HBV"],"6in1-4":["Tetanus","Diphtheria","Pertusis","Polio","Hib","HBV"],"13PCV-1":["PCV"],"13PCV-2":["PCV"],"13PCV-3":["PCV"],"13PCV-4":["PCV"],"DTaP-IPV-1":["Tetanus","Diphtheria","Pertusis","Polio"],"DTaP-IPV-2":["Tetanus","Diphtheria","Pertusis","Polio"],"DTaP-IPV-3":["Tetanus","Diphtheria","Pertusis","Polio"],"DTaP-IPV-4":["Tetanus","Diphtheria","Pertusis","Polio"],MV:["Measles"],"DTaP-1":["Tetanus","Diphtheria","Pertusis"],"DTaP-2":["Tetanus","Diphtheria","Pertusis"],"DTaP-3":["Tetanus","Diphtheria","Pertusis"],"DTaP-4":["Tetanus","Diphtheria","Pertusis"],"DTaP-5":["Tetanus","Diphtheria","Pertusis"],"IPV-1":["Polio"],"IPV-2":["Polio"],"IPV-3":["Polio"],"IPV-4":["Polio"],"IPV-5":["Polio"],"Hib-1":["Hib"],"Hib-2":["Hib"],"Hib-3":["Hib"],"Hib-4":["Hib"],"DTP-1":["Tetanus","Diphtheria","Pertusis"],"DTP-2":["Tetanus","Diphtheria","Pertusis"],"DTP-3":["Tetanus","Diphtheria","Pertusis"],"DTP-4":["Tetanus","Diphtheria","Pertusis"],"DT-1":["Tetanus","Diphtheria"],"DT-2":["Tetanus","Diphtheria"],"DT-3":["Tetanus","Diphtheria"],"DT-4":["Tetanus","Diphtheria"],"7PCV-1":["PCV"],"7PCV-2":["PCV"],"7PCV-3":["PCV"],"7PCV-4":["PCV"],"10PCV-1":["PCV"],"10PCV-2":["PCV"],"10PCV-3":["PCV"],"10PCV-4":["PCV"],"HepAB-1":["HAV","HBV"],"HepAB-2":["HAV","HBV"],"HepAB-3":["HAV","HBV"],Tdap:["AP"],"+BCG":["BCG"],"HepB-LBW":["HBV"],"HepB-LBWe":["HBV"],"HepB-LBWs":["HBV"],"HepB-LBWu":["HBV"],"+JE-1":["JE"],"+JE-2":["JE"],"+Td-1":["Tetanus","Diphtheria"],"+Td-2":["Tetanus","Diphtheria"],"+Tdap-IPV-1":["AP"],"+Tdap-IPV-2":["AP"],"+MMR-1":["Measles","Mumps","Rubella"],"+MMR-2":["Measles","Mumps","Rubella"],"+rHepB-1":["HBV"],"+rHepB-2":["HBV"],"+rHepB-3":["HBV"],"pHepB-1":["HBV"],"pHepB-2":["HBV"],"pHepB-3":["HBV"],"pHepB-4":["HBV"],Mumps:["Mumps"],"+MV":["Measles"],"OPV-1":["Polio"],"OPV-2":["Polio"],"OPV-3":["Polio"],"OPV-4":["Polio"],"OPV-5":["Polio"],"+OPV-1":["Polio"],"+OPV-2":["Polio"],"+OPV-3":["Polio"],"+IPV-1":["Polio"],"+IPV-2":["Polio"],"+IPV-3":["Polio"],"DTaP-IPV-5":["AP"],"+DTaP-IPV-1":["Tetanus","Diphtheria","Pertusis","Polio","AP"],"+DTaP-IPV-2":["Tetanus","Diphtheria","Pertusis","Polio","AP"],"MMRV-1":["Measles","Mumps","Rubella","Var"],"MMRV-2":["Measles","Mumps","Rubella","Var"],"+2HepA-1":["HAV"],"+2HepA-2":["HAV"],"3HepA-1":["HAV"],"3HepA-2":["HAV"],"3HepA-3":["HAV"],MMR0:["Measles","Mumps","Rubella"],"MR-1":["Measles","Rubella"],"MR-2":["Measles","Rubella"],RV:["Rubella"],"Var-1":["Var"],"Var-2":["Var"],MMR:["Measles","Mumps","Rubella"],"15PCV-1":["PCV"],"15PCV-2":["PCV"],"15PCV-3":["PCV"],"15PCV-4":["PCV"],"DTaP-HepB-IPV-1":["Tetanus","Diphtheria","Pertusis","Polio","HBV"],"DTaP-HepB-IPV-2":["Tetanus","Diphtheria","Pertusis","Polio","HBV"],"DTaP-HepB-IPV-3":["Tetanus","Diphtheria","Pertusis","Polio","HBV"],"DTaP-HepB-IPV-4":["Tetanus","Diphtheria","Pertusis","Polio","HBV"],"DTaP-HepB-IPV-5":["Tetanus","Diphtheria","Pertusis","Polio","HBV","AP"],TT:["Tetanus"],"DTwP-HepB-Hib-1":["Tetanus","Diphtheria","Pertusis","Polio","HBV"],"DTwP-HepB-Hib-2":["Tetanus","Diphtheria","Pertusis","Polio","HBV"],"DTwP-HepB-Hib-3":["Tetanus","Diphtheria","Pertusis","Polio","HBV"],"DTwP-HepB-Hib-4":["Tetanus","Diphtheria","Pertusis","Polio","HBV"],"DTwP-HepB-Hib-5":["Tetanus","Diphtheria","Pertusis","Polio","HBV","AP"],rHepB:["HBV"],"20PCV-1":["PCV"],"20PCV-2":["PCV"],"20PCV-3":["PCV"],"20PCV-4":["PCV"]},vacprolist=["HBV","Tetanus","Diphtheria","Pertusis","Hib","Polio","PCV","BCG","Measles","Mumps","Rubella","Var","HAV","JE","AP"],returnvalue=E(patientidbirth,resultobj),z(returnvalue,patientidbirth)}function n(e){for(applylistbyvaccine={},a=0;a<e.ApplyRecord.length;a++)SRVC=e.ApplyRecord[a].SRVC,temprecord={},temprecord.ID=e.ApplyRecord[a].ID,temprecord.ON=e.ApplyRecord[a].ON,temprecord.VB=e.ApplyRecord[a].VB,temprecord.SRVC=SRVC,applylistbyvaccine[SRVC]=temprecord;return applylistbyvaccine}function i(e){return TBY=1*e.substring(0,3),TBM=1*e.substring(3,5),TBD=1*e.substring(5,7),ND=new Date,NY=ND.getFullYear()-1911,NM=ND.getMonth()+1,ND=ND.getDate(),DO=ND-TBD,MO=NM-TBM,YO=NY-TBY,DO<0&&(DO+=30,MO-=1),MO<0&&(MO+=12,YO-=1),returnvalue=[YO,MO,DO],returnvalue}function r(e){return TBY=1*e.substring(0,3),ND=new Date,NY=ND.getFullYear()-1911,NY-TBY}function l(e,t){return TBY=1*e.substring(0,3)+1911,IDY=new Date(t).getFullYear(),IDY-TBY}function o(e,t){return TBY=1*e.substring(0,3)+1911,TBM=1*e.substring(3,5),TBD=1*e.substring(3,5),IDY=new Date(t).getFullYear(),IDM=new Date(t).getMonth()+1,IDD=new Date(t).getDate(),DDY=IDY-TBY,DDM=IDM-TBM,DDD=IDD-TBD,DDD<0&&(DDD+=30,DDM-=1),DDM<0&&(DDM+=12,DDY-=1),VMO=12*DDY+DDM,VMO}function s(e,t){return date_1=new Date(e),date_2=new Date(date_1.getTime()+1e3*t*3600*24+288e5).toISOString(),date_2}function p(e){for(needtoapplylist=[],recvaccinelist={0:["rHepB-1"],1:["rHepB-2"],2:["13PCV-1","5in1-1"],4:["13PCV-2","5in1-2"],5:["BCG"],6:["rHepB-3","5in1-3"],12:["MMR-1","Var-1","2HepA-1","13PCV-3"],15:["JE-CV_LiveAtd-1"],18:["2HepA-2","5in1-4"],27:["JE-CV_LiveAtd-2"],60:["DTaP-IPV-5","MMR-2"]},monthlist=Object.keys(recvaccinelist),b=0;b<monthlist.length;b++)if(monthlist[b]<=e)for(c=0;c<recvaccinelist[monthlist[b]].length;c++)needtoapplylist.push(recvaccinelist[monthlist[b]][c]);return needtoapplylist}function u(e){recvaccinelist={0:["rHepB-1"],1:["rHepB-2"],2:["13PCV-1","5in1-1"],4:["13PCV-2","5in1-2"],5:["BCG"],6:["rHepB-3","5in1-3"],12:["MMR-1","Var-1","2HepA-1","13PCV-3"],15:["JE-CV_LiveAtd-1"],18:["2HepA-2","5in1-4"],27:["JE-CV_LiveAtd-2"],60:["DTaP-IPV-5","MMR-2"]},monthlist=Object.keys(recvaccinelist),nexttimevaccine=[];for(let t=0;t<monthlist.length;t++)if(monthlist[t]>e){nexttimevaccine=recvaccinelist[monthlist[t]];break}return nexttimevaccine}function m(e,t){if(old_array=i(t),monthold=1*(12*old_array[0]+old_array[1]+old_array[2]/30).toFixed(2),ageold=r(t),need_array=p(monthold),next_array=u(monthold),applylist=n(e),returnobj={},returnobj.needtoapply={},returnobj.nexttoapply={},applylist_array=Object.keys(applylist),applylist_array.includes("13PCV-3")&&(PCV3ID=applylist["13PCV-3"].ID,PCV3IDageold=o(t,PCV3ID),PCV3IDageold<12&&monthold>=12&&need_array.push("13PCV-4")),applypro=P(applylist_array),needpro=P(need_array),monthold<216){for(d=0;d<need_array.length;d++)applylist_array.includes(need_array[d])||(returnobj.needtoapply[need_array[d]]=C(applylist,need_array[d],t));for(let e=0;e<next_array.length;e++)returnobj.nexttoapply[next_array[e]]=C(applylist,next_array[e],t)}return returnobj}function y(e){return mkyy=e.substring(0,3),mkym=e.substring(3,5),mkyd=e.substring(5,7),cyy=1*mkyy+1911,cyd=cyy+"-"+mkym+"-"+mkyd,new Date(cyd)}function _(e,t,n){return cyd=new Date(e),cyy=cyd.getFullYear(),cym=cyd.getMonth()+1,cyd=cyd.getDate(),cyy+=t,cym+=n,cym>12&&(cym-=12,cyy+=1),ncyd=cyy+"-"+cym+"-"+cyd,date_1=new Date(ncyd),date_2=new Date(date_1.getTime()+288e5),date_2}function v(e){return cyd=new Date(e),cyy=cyd.getFullYear()-1911,cym=cyd.getMonth()+1,cyd=cyd.getDate(),mky="000"+cyy,mky=mky.substring(mky.length-3,mky.length),mkm="00"+cym,mkm=mkm.substring(mkm.length-2,mkm.length),mkd="00"+cyd,mkd=mkd.substring(mkd.length-2,mkd.length),mkdate=mky+mkm+mkd,mkdate}function C(t,n,i){for(activevaccine=["MMR","MMR-1","MMR-2","Var-1","Var-2","JE-CV_LiveAtd-1","JE-CV_LiveAtd-2"],birthcy=y(i),ALD="",ALDNa="",applykeys=Object.keys(t),e=0;e<activevaccine.length;e++)applykeys.includes(activevaccine[e])&&(ALDN=new Date(t[activevaccine[e]].ID),""==ALD?(ALD=ALDN,ALDNa=activevaccine[e]):ALDN>ALD&&(ALD=ALDN,ALDNa=activevaccine[e]));if(vaccinelist.includes(n)){if("rHepB-1"==n&&(LD="",recommandtime=birthcy,recommandtimeC="出生24小時內儘速",leastinterval=birthcy,leastintervalC="出生24小時內儘速"),"rHepB-2"==n&&(applykeys.includes("rHepB-1")?(LD=t["rHepB-1"].ID,recommandtime1=_(LD,0,1),recommandtime2=_(birthcy,0,1),recommandtime1>recommandtime2?recommandtime=recommandtime1:recommandtime=recommandtime2,recommandtimeC="1個月大(與第一劑間隔1個月)",leastinterval=s(LD,28),leastintervalC="間隔4週(28天)"):(LD="",recommandtime="",recommandtimeC="未接種第一劑",leastinterval="",leastintervalC="未接種第一劑")),"rHepB-3"==n&&(applykeys.includes("rHepB-2")?(LD=t["rHepB-2"].ID,recommandtime1=_(LD,0,5),recommandtime2=_(birthcy,0,6),recommandtime1>recommandtime2?recommandtime=recommandtime1:recommandtime=recommandtime2,recommandtimeC="6個月大(第二劑間隔5個月)",leastinterval1=s(LD,56),applykeys.includes("rHepB-1")&&(LD2=t["rHepB-1"].ID,leastinterval2=s(LD2,112)),leastinterval1>leastinterval2?leastinterval=leastinterval:leastinterval=leastinterval2,leastintervalC="與第二劑間隔56天且第1、第3劑應間隔至少16週"):(LD="",recommandtime="",recommandtimeC="未接種第二劑",leastinterval="",leastintervalC="未接種第二劑")),"5in1-1"==n&&(LD="",recommandtime1=s(birthcy,60),recommandtime2=_(birthcy,0,2),recommandtime1>recommandtime2?recommandtime=recommandtime1:recommandtime=recommandtime2,recommandtimeC="2個月",leastinterval=s(birthcy,42),leastintervalC="6週"),"5in1-2"==n&&(applykeys.includes("5in1-1")?(LD=t["5in1-1"].ID,recommandtime1=_(LD,0,2),recommandtime2=_(birthcy,0,4),recommandtime1>recommandtime2?recommandtime=recommandtime1:recommandtime=recommandtime2,recommandtimeC="4個月(與第一劑間隔2個月)",leastinterval=s(LD,28),leastintervalC="4週(與第一劑間隔28天)"):(LD="",recommandtime="",recommandtimeC="未接種第一劑",leastinterval="",leastintervalC="未接種第一劑")),"5in1-3"==n&&(applykeys.includes("5in1-2")?(LD=t["5in1-2"].ID,recommandtime1=_(LD,0,2),recommandtime2=_(birthcy,0,6),recommandtime1>recommandtime2?recommandtime=recommandtime1:recommandtime=recommandtime2,recommandtimeC="6個月(與第二劑間隔2個月)",leastinterval=s(LD,28),leastintervalC="4週(與第二劑間隔28天)"):(LD="",recommandtime="",recommandtimeC="未接種第二劑",leastinterval="",leastintervalC="未接種第二劑")),"5in1-4"==n&&(applykeys.includes("5in1-3")?(LD=t["5in1-3"].ID,recommandtime1=_(LD,1,0),recommandtime2=_(birthcy,1,6),recommandtime1>recommandtime2?recommandtime=recommandtime1:recommandtime=recommandtime2,recommandtimeC="18個月(與第三劑間隔1年)",leastinterval1=s(LD,180),leastinterval2=_(birthcy,1,0),leastinterval1>leastinterval2?leastinterval=leastinterval1:leastinterval=leastinterval2,leastintervalC="間隔6個月(與第二劑間隔180天)且滿1歲後"):(LD="",recommandtime="",recommandtimeC="未接種第三劑",leastinterval="",leastintervalC="未接種第三劑")),"13PCV-1"==n&&(LD="",recommandtime1=s(birthcy,60),recommandtime2=_(birthcy,0,2),recommandtime1>recommandtime2?recommandtime=recommandtime1:recommandtime=recommandtime2,recommandtimeC="2個月大",leastinterval=s(birthcy,42),leastintervalC="6週大"),"13PCV-2"==n&&(applykeys.includes("13PCV-1")?(LD=t["13PCV-1"].ID,recommandtime1=_(LD,0,2),recommandtime2=_(birthcy,0,4),recommandtime1>recommandtime2?recommandtime=recommandtime1:recommandtime=recommandtime2,recommandtimeC="4個月大(第一劑間隔2個月)",leastinterval=s(LD,56),leastintervalC="間隔8週(56天)"):(LD="",recommandtime="",recommandtimeC="未接種第一劑",leastinterval="",leastintervalC="未接種第一劑")),"13PCV-3"==n&&(applykeys.includes("13PCV-2")?(LD=t["13PCV-2"].ID,recommandtime1=_(LD,0,8),recommandtime2=_(birthcy,1,0),recommandtime1>recommandtime2?recommandtime=recommandtime1:recommandtime=recommandtime2,recommandtimeC="12個月大(與第二劑間隔8個月)",leastinterval1=s(LD,56),leastinterval2=_(birthcy,1,0),leastinterval1>leastinterval2?leastinterval=leastinterval1:leastinterval=leastinterval2,leastintervalC="間隔8週且滿1歲(與第二劑間隔56天)"):(LD="",recommandtime="",recommandtimeC="未接種第二劑",leastinterval="",leastintervalC="未接種第二劑")),"13PCV-4"==n&&(applykeys.includes("13PCV-3")?(LD=t["13PCV-3"].ID,recommandtime1=_(LD,0,6),recommandtime2=_(birthcy,1,0),recommandtime1>recommandtime2?recommandtime=recommandtime1:recommandtime=recommandtime2,recommandtimeC="12個月大(與第三劑間隔6個月)",leastinterval1=s(LD,56),leastinterval2=_(birthcy,1,0),leastinterval1>leastinterval2?leastinterval=leastinterval1:leastinterval=leastinterval2,leastintervalC="間隔8週且滿1歲(與第三劑間隔56天)"):(LD="",recommandtime="",recommandtimeC="未接種第二劑",leastinterval="",leastintervalC="未接種第二劑")),"BCG"==n&&(LD="",recommandtime=_(birthcy,0,5),recommandtimeC="5個月",leastinterval=birthcy,leastintervalC="出生後"),"MMR-1"==n&&(LD="",""==ALD?(recommandtime=_(birthcy,1,0),recommandtimeC="12個月",leastinterval=_(birthcy,1,0),leastintervalC="12個月"):(recommandtime1=_(birthcy,1,0),recommandtime2=s(ALD,29),recommandtime1>recommandtime2?(recommandtime=recommandtime1,leastinterval=recommandtime1,recommandtimeC="12個月",leastintervalC="12個月"):(recommandtime=recommandtime2,leastinterval=recommandtime2,recommandtimeC="滿12個月且與"+ALDNa+"間隔28+1天",leastintervalC="滿12個月且與"+ALDNa+"間隔28+1天"))),"MMR-2"==n&&(applykeys.includes("MMR-1")?(LD=t["MMR-1"].ID,""==ALD?(recommandtime=_(birthcy,5,0),recommandtimeC="滿5歲",leastinterval=s(LD,29),leastintervalC="隔4週(與第一劑間隔28+1天)"):(recommandtime1=_(birthcy,5,0),recommandtime2=s(ALD,29),recommandtime1>recommandtime2?(recommandtime=recommandtime1,recommandtimeC="滿5歲"):(recommandtime=recommandtime2,recommandtimeC="滿5歲且與"+ALDNa+"間隔28+1天"),leastinterval1=s(ALD,29),leastinterval2=s(LD,29),leastinterval1>leastinterval2?(leastinterval=leastinterval1,leastintervalC="隔4週(與第一劑間隔28+1天)"):(leastinterval=leastinterval2,leastintervalC="與"+ALDNa+"間隔28天"))):(LD="",recommandtime="",recommandtimeC="未接種第一劑",leastinterval="",leastintervalC="未接種第一劑")),"Var-1"==n&&(LD="",""==ALD?(recommandtime=_(birthcy,1,0),recommandtimeC="12個月",leastinterval=_(birthcy,1,0),leastintervalC="12個月"):(recommandtime1=_(birthcy,1,0),recommandtime2=s(ALD,29),recommandtime1>recommandtime2?(recommandtime=recommandtime1,leastinterval=recommandtime1,recommandtimeC="12個月",leastintervalC="12個月"):(recommandtime=recommandtime2,leastinterval=recommandtime2,recommandtimeC="滿12個月且與"+ALDNa+"間隔28(+1)天",leastintervalC="滿12個月且與"+ALDNa+"間隔28(+1)天"))),"2HepA-1"==n&&(LD="",recommandtime=_(birthcy,1,0),recommandtimeC="12個月",leastinterval=_(birthcy,1,0),leastintervalC="12個月"),"2HepA-2"==n&&(applykeys.includes("2HepA-1")?(LD=t["2HepA-1"].ID,recommandtime1=_(LD,0,6),recommandtime2=_(birthcy,1,6),recommandtime1>recommandtime2?recommandtime=recommandtime1:recommandtime=recommandtime2,recommandtimeC="18個月(與第一劑間隔6個月)",leastinterval=_(LD,0,6),leastintervalC="與第一劑間隔6個月"):(LD="",recommandtime="",recommandtimeC="未接種第一劑",leastinterval="",leastintervalC="未接種第一劑")),"JE-CV_LiveAtd-1"==n&&(LD="",""==ALD?(recommandtime=_(birthcy,1,3),recommandtimeC="15個月",leastinterval=_(birthcy,1,0),leastintervalC="12個月"):(recommandtime1=_(birthcy,1,3),recommandtime2=s(ALD,29),recommandtime1>recommandtime2?(recommandtime=recommandtime1,recommandtimeC="15個月"):(recommandtime=recommandtime2,recommandtimeC="滿15個月且與"+ALDNa+"間隔28+1天"),leastinterval1=_(birthcy,1,0),leastinterval2=s(ALD,29),leastinterval1>leastinterval2?(leastinterval=leastinterval1,leastintervalC="12個月"):(leastinterval=leastinterval2,leastintervalC="滿12個月且與"+ALDNa+"間隔28+1天"))),"JE-CV_LiveAtd-2"==n&&(applykeys.includes("JE-CV_LiveAtd-1")?(LD=t["JE-CV_LiveAtd-1"].ID,""==ALD?(recommandtime1=_(LD,1,0),recommandtime1=s(recommandtime1,1),recommandtime2=_(birthcy,2,3),recommandtime2=s(recommandtime2,1),recommandtime1>recommandtime2?recommandtime=recommandtime1:recommandtime=recommandtime2,recommandtimeC="27個月+1天(與第一劑間隔12個月+1天)",leastinterval=_(LD,1,0),leastinterval=s(leastinterval,1),leastintervalC="與第一劑間隔12個月+1天"):(recommandtime1=_(LD,1,0),recommandtime1=s(recommandtime1,1),recommandtime2=s(ALD,29),recommandtime1>recommandtime2?(recommandtime=recommandtime1,recommandtimeC="27個月+1天(與第一劑間隔12個月+1天)"):(recommandtime=recommandtime2,recommandtimeC="第一劑間隔12個月+1天且與"+ALDNa+"間隔28+1天"),leastinterval1=_(LD,1,0),leastinterval1=s(leastinterval1,1),leastinterval2=s(ALD,29),leastinterval1>leastinterval2?(leastinterval=leastinterval1,leastintervalC="與第一劑間隔12個月+1天"):(leastinterval=leastinterval2,leastintervalC="與第一劑間隔12個月+1天且與"+ALDNa+"間隔28天"))):(LD="",recommandtime="",recommandtimeC="未接種第一劑",leastinterval="",leastintervalC="未接種第一劑")),"DTaP-IPV-5"==n&&(LD="",recommandtime=_(birthcy,5,0),recommandtimeC="滿5歲",leastinterval=_(birthcy,4,0),leastintervalC="滿4歲"),temparray={},temparray.name=n,temparray.LD=LD,temparray.recommandtime=recommandtime,temparray.recommandtimeC=recommandtimeC,temparray.leastinterval=leastinterval,temparray.leastintervalC=leastintervalC,now0=new Date,nowy=now0.getFullYear(),nowm=now0.getMonth()+1,nowd=now0.getDate(),nowm=nowm.toString().padStart(2,"0"),nowd=nowd.toString().padStart(2,"0"),now=new Date(nowy.toString()+"-"+nowm.toString()+"-"+nowd.toString()+"T15:00:00.000Z"),now>=new Date(leastinterval)){for(thevacpro=vacnameprolist[n],pass=!0,zz=0;zz<thevacpro.length;zz++)apro=Math.ceil(applypro[thevacpro[zz]]),npro=Math.ceil(needpro[thevacpro[zz]]),apro<npro&&(pass=!1);pass?now>=new Date(recommandtime)?(temparray.allsug="?_O",temparray.allsugC="請檢查是否有接種替代疫苗，若無建議接種"):(temparray.allsug="?_▲",temparray.allsugC="請檢查是否有接種替代疫苗，若無可接種(符合最短間隔)"):now>=new Date(recommandtime)?(temparray.allsug="O",temparray.allsugC="建議接種"):(temparray.allsug="▲",temparray.allsugC="僅符合最短接種時程")}else temparray.allsug="X",temparray.allsugC="不符合接種時程";return temparray}}function P(e){for(vacpro={},aa=0;aa<vacprolist.length;aa++)vacpro[vacprolist[aa]]=0;for(ab=0;ab<e.length;ab++)if(thevacname=e[ab],Object.keys(vacnameprolist).includes(thevacname))for(thevacprolist=vacnameprolist[thevacname],["JE-1","JE-2","JE-3","JE-4","JE-VC_Inactd-1","JE-VC_Inactd-2","JE-VC_Inactd-3","JE-VC_Inactd-4"].includes(thevacname)?vproc=.3:vproc=1,ac=0;ac<thevacprolist.length;ac++)vacpro[thevacprolist[ac]]+=vproc;return vacpro}function x(e,t){if(now=new Date,nowy=now.getFullYear(),nowm=now.getMonth()+1,nowm>=10?sy=nowy:sy=nowy-1,flustarttime=new Date(sy+"-10-01 "),old_array=i(t),monthold=1*(12*old_array[0]+old_array[1]+old_array[2]/30).toFixed(2),retobj={},errmsg="",flulist=[],monthold>=6){for(f=0;f<e.ApplyRecord.length;f++)SRVC=e.ApplyRecord[f].SRVC,SRVC.includes("Flu")&&flulist.push(e.ApplyRecord[f]);0==flulist.length?(suggest="O",monthold<108?errmsg="未滿9歲,需接種第二劑":errmsg="不曾接種",LD="",LDsite=""):(LD=flulist[flulist.length-1].ID,LDdate=new Date(LD),LDdate>=flustarttime?1==flulist.length&&monthold<108?now>=new Date(s(LDdate,28))?(suggest="2",LDsite=flulist[flulist.length-1].ON,errmsg="第二劑,間隔滿28天"):(suggest="X",LDsite=flulist[flulist.length-1].ON,errmsg="第二劑間隔未滿28天"):(suggest="X",LDsite=flulist[flulist.length-1].ON,errmsg="當年度已接種"):(suggest="O",errmsg="當年度未接種",LDsite=flulist[flulist.length-1].ON))}else suggest="X",LD="",LDsite="",errmsg="未滿6個月";return retobj.suggest=suggest,retobj.LD=LD,retobj.LDsite=LDsite,retobj.errmsg=errmsg,retobj}function D(e,t){for(ageold=r(t),PPVlist=[],PCVlist=[],g=0;g<e.ApplyRecord.length;g++)SRVC=e.ApplyRecord[g].SRVC,SRVC.includes("PPV")&&PPVlist.push(e.ApplyRecord[g]),SRVC.includes("PCV")&&l(t,e.ApplyRecord[g].ID)>18&&PCVlist.push(e.ApplyRecord[g]);return PPVlist.length>0?(PPVsuggest="X",PPVcomment="已接種過PPV",PPVLD=PPVlist[PPVlist.length-1].ID,PPVLDS=PPVlist[PPVlist.length-1].ON):ageold>=65?PCVlist.length>0?(PCVLD=PCVlist[PCVlist.length-1].ID,now=new Date,now>=_(PCVLD,1,0)?(PPVsuggest="O",PPVcomment="已接種過PCV13,間隔滿1年",PPVLD="",PPVLDS=""):(PPVsuggest="X",PPVcomment="已接種過PCV1,間隔未滿1年",PPVLD="",PPVLDS="")):(PPVsuggest="▲",PPVcomment="年滿65歲,優先接種PCV13",PPVLD="",PPVLDS=""):ageold>=50&&ageold<65?(PPVsuggest="▲",PPVcomment="55-64專案",PPVLD="",PPVLDS=""):(PPVsuggest="X",PPVcomment="未滿50歲,無法施打PPV",PPVLD="",PPVLDS=""),PCVlist.length>0?(PCVsuggest="X",PCVcomment="已接種過PCV",PCVLD=PCVlist[PCVlist.length-1].ID,PCVLDS=PCVlist[PCVlist.length-1].ON):ageold>=65?PPVlist.length>0?(PPVLD=PPVlist[PPVlist.length-1].ID,now=new Date,now>=_(PPVLD,1,0)?(PCVsuggest="O",PCVcomment="已接種過PPV,間隔滿1年",PCVLD="",PCVLDS=""):(PCVsuggest="X",PCVcomment="已接種過PPV,間隔未滿1年",PCVLD="",PCVLDS="")):(PCVsuggest="O",PCVcomment="可接種PCV",PCVLD="",PCVLDS=""):(PCVsuggest="X",PCVcomment="未滿65歲,無法施打PCV",PCVLD="",PCVLDS=""),retobj={},retobj.PCV={},retobj.PCV.PCVsuggest=PCVsuggest,retobj.PCV.PCVcomment=PCVcomment,retobj.PCV.PCVLD=PCVLD,retobj.PCV.PCVLDS=PCVLDS,retobj.PPV={},retobj.PPV.PPVsuggest=PPVsuggest,retobj.PPV.PPVcomment=PPVcomment,retobj.PPV.PPVLD=PPVLD,retobj.PPV.PPVLDS=PPVLDS,retobj}function I(e,t){if(old_array=i(t),monthold=1*(12*old_array[0]+old_array[1]+old_array[2]/30).toFixed(2),retobj={},monthold>6){for(CoVlist=[],h=0;h<e.ApplyRecord.length;h++)SRVC=e.ApplyRecord[h].SRVC,SRVC.includes("CoV_")&&CoVlist.push(e.ApplyRecord[h]);CoVlist.length>0?(theSRVC=CoVlist[CoVlist.length-1].SRVC,retobj.count=CoVlist.length,COVLD=CoVlist[CoVlist.length-1].ID,retobj.LD=COVLD,retobj.LDsite=CoVlist[CoVlist.length-1].ON,retobj.LDtype=theSRVC,now=new Date,now>=_(COVLD,0,3)?retobj.suggest="O":retobj.suggest="X"):(retobj.count=CoVlist.length,retobj.LD="",retobj.LDsite="",retobj.LDtype="",retobj.suggest="O")}else retobj.count=0,retobj.LD="",retobj.LDsite="",retobj.LDtype="<6個月不接種新冠疫苗",retobj.suggest="X";return retobj}function w(e,t){return returnobj={},returnobj.routine=m(e,t),returnobj.flu=x(e,t),returnobj.PV=D(e,t),returnobj.CoV=I(e,t),returnobj}function E(e,t){return result=t,vaccinesug=w(t,e),theretobj={},theretobj.patientName=thename,theretobj.vaccinesuggestion=vaccinesug,theretobj.niisapplylist=result,testmode?theretobj:(theretobj_string=JSON.stringify(theretobj),theretobj_string)}}function G(e){let t,n=Y("https://phpcis.chshb.gov.tw/api/v1/personal_infos/list?bureauRecordNo="+e),i=JSON.parse(n);return 1==i.result.length&&i.result[0]}function Y(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText}function z(e,t){let n=JSON.parse(e);null!=document.getElementById("create_niisdrag")&&document.getElementById("create_niisdrag").remove(),thewidth=610,theheight=500,borderx=20,bordery=150;var i=document.createElement("div");i.id="create_niisdrag",i.style.width=thewidth+"px",i.style.left=(window.innerWidth-thewidth)/2+"px",i.style.top=bordery+"px",i.style.background="#f9f9f9",i.style.border="1px solid #ccc",i.style.position="absolute",i.style.zIndex="9999";let r=t.substring(0,3),l=t.substring(3,5),o=t.substring(5,7),s=(new Date).getFullYear()-1911-r,a=(new Date).getMonth()+1-l,c=(new Date).getDate()-o;c<0&&(a-=1,c+=30),a<0&&(s-=1,a+=12);let d="";d=0==s?a+"月"+c+"天":s+"歲"+a+"月"+c+"天";let p=2,u=2,m=2;div_name=h(p,u,40,25),div_name.textContent="姓名:",p=p+40+2,div_name=h(p,u,500,25),div_name.textContent=n.patientName+"("+d+")",div_name.style.textAlign="left",div_exit=b(585,u,25,25),div_exit.textContent="X",div_exit.addEventListener("click",function(){null!=document.getElementById("create_niisdrag")&&document.getElementById("create_niisdrag").remove()}),p=p+40+2,p=2,u+=25,div_flu=h(p,u,40,25),div_flu.textContent="flu:",div_flu.style.textAlign="right",p=p+40+2,div_fluc=h(p,u,110,25),div_fluc.textContent=y(n.vaccinesuggestion.flu.LD)+"("+n.vaccinesuggestion.flu.suggest+")",div_fluc.style.textAlign="left","O"!=n.vaccinesuggestion.flu.suggest&&"2"!=n.vaccinesuggestion.flu.suggest||(div_fluc.style.color="blue"),div_fluc.title=n.vaccinesuggestion.flu.errmsg+"\n上次接種時間:"+y(n.vaccinesuggestion.flu.LD)+"\n上次接種地點:"+n.vaccinesuggestion.flu.LDsite,p=p+110+2,div_PPV=h(p,u,40,25),div_PPV.textContent="PPV:",div_PPV.style.textAlign="right",p=p+40+2,div_PPVc=h(p,u,110,25),div_PPVc.textContent=y(n.vaccinesuggestion.PV.PPV.PPVLD)+"("+n.vaccinesuggestion.PV.PPV.PPVsuggest+")",div_PPVc.style.textAlign="left","O"==n.vaccinesuggestion.PV.PPV.PPVsuggest&&(div_PPVc.style.color="blue"),div_PPVc.title=n.vaccinesuggestion.PV.PPV.PPVcomment+"\n上次接種時間:"+y(n.vaccinesuggestion.PV.PPV.PPVLD)+"\n上次接種地點:"+n.vaccinesuggestion.PV.PPV.PPVLDS,p=p+110+2,div_PCV=h(p,u,40,25),div_PCV.textContent="PCV:",div_PCV.style.textAlign="right",p=p+40+2,div_PCVc=h(p,u,110,25),div_PCVc.textContent=y(n.vaccinesuggestion.PV.PCV.PCVLD)+"("+n.vaccinesuggestion.PV.PCV.PCVsuggest+")",div_PCVc.style.textAlign="left","O"==n.vaccinesuggestion.PV.PCV.PCVsuggest&&(div_PCVc.style.color="blue"),div_PCVc.title=n.vaccinesuggestion.PV.PCV.PCVcomment+"\n上次接種時間:"+y(n.vaccinesuggestion.PV.PCV.PCVLD)+"\n上次接種地點:"+n.vaccinesuggestion.PV.PCV.PCVLDS,p=p+110+2,div_COV=h(p,u,40,25),div_COV.textContent="COV:",div_COV.style.textAlign="right",p=p+40+2,div_COVc=h(p,u,110,25),div_COVc.textContent=y(n.vaccinesuggestion.CoV.LD)+"("+n.vaccinesuggestion.CoV.suggest+")",div_COVc.style.textAlign="left","O"==n.vaccinesuggestion.CoV.suggest&&(div_COVc.style.color="blue"),div_COVc.title="共接種"+n.vaccinesuggestion.CoV.count+"劑\n上次接種時間:"+y(n.vaccinesuggestion.CoV.LD)+"\n上次接種地點:"+n.vaccinesuggestion.CoV.LDsite,p=2,u+=25,div_ti=h(p,u,500,25),div_ti.textContent="1. 疫苗接種紀錄",div_ti.style.textAlign="left",u+=25,tab_his=g(p,u,600,150,["劑次","日期","地點"]);for(let e=0;e<n.niisapplylist.ApplyRecord.length;e++){let t=tab_his.insertRow(1),i=n.niisapplylist.ApplyRecord[e],r=[i.SRVC,y(i.ID),i.ON];for(let e=0;e<r.length;e++){let n=document.createElement("td");n.style.border="1px solid #ddd",n.style.minWidth="100px",n.style.whiteSpace="nowrap",n.textContent=r[e],t.appendChild(n)}}u+=150,div_ti=h(p,u,500,25),div_ti.textContent="2. 應接種疫苗",div_ti.style.textAlign="left",u+=25,tab_rou=g(p,u,600,150,["常規疫苗","上次接種","檢核","建議接種時間","最小接種時間"]),needkeys=Object.keys(n.vaccinesuggestion.needtoapply);for(let e=0;e<needkeys.length;e++){let t=n.vaccinesuggestion.needtoapply[needkeys[e]],i=document.createElement("tr"),r=[t.name,y(t.LD),t.allsug,y(t.recommandtime),y(t.leastinterval)];for(let e=0;e<r.length;e++){let n=document.createElement("td");n.style.border="1px solid #ddd",n.style.minWidth="100px",n.style.whiteSpace="nowrap",n.textContent=r[e],2==e?n.title=t.allsugC:3==e?n.title=t.recommandtimeC:4==e&&(n.title=t.leastintervalC),i.appendChild(n)}tab_rou.appendChild(i)}if(u+=155,nextkeys=Object.keys(n.vaccinesuggestion.nexttoapply),nexttxt=h(p,u,600,25),nexttxt.style.textAlign="left",0==nextkeys.length)nexttxt.textContent="已完成常規疫苗",nexttxt.style.color="blue";else{nexttxt.textContent="未完成常規疫苗",nexttxt.style.color="red";for(let e=0;e<nextkeys.length;e++){u+=25;let t=n.vaccinesuggestion.nexttoapply[nextkeys[e]],i=h(p,u,600,25);i.style.textAlign="left",i.textContent=t.name+"，建議:"+y(t.recommandtime)+"，最短:"+y(t.leastinterval);let r="上次接種日期: "+y(t.LD);r=(r=(r=(r=r+"\n建議接種時程: "+y(t.recommandtime))+"\n建議時程說明: "+t.recommandtimeC)+"\n最短接種時程: "+y(t.leastinterval))+"\n最短時程說明: "+t.leastintervalC,i.title=r}}function h(e,t,n,r){let l=document.createElement("div");return l.style.width=n+"px",l.style.height=r+"px",l.style.left=e+"px",l.style.top=t+"px",l.style.position="absolute",l.style.textAlign="center",i.appendChild(l),l}function b(e,t,n,r){let l=document.createElement("button");return l.style.width=n+"px",l.style.height=r+"px",l.style.left=e+"px",l.style.top=t+"px",l.style.position="absolute",l.style.textAlign="center",i.appendChild(l),l}function g(e,t,n,r,l){let o=document.createElement("div");o.style.borderCollapse="collapse",o.style.width=n+"px",o.style.height=r+"px",o.style.left=e+"px",o.style.top=t+"px",o.style.position="absolute",o.style.textAlign="center",o.style.overflowY="auto",o.style.overflowX="scroll",o.style.border="1px solid";let s=document.createElement("table"),a=document.createElement("thead"),c=document.createElement("tr");for(let e=0;e<l.length;e++){let t=document.createElement("th");t.textContent=l[e],t.style.border="1px solid #ddd",t.style.backgroundColor="#f2f2f2",t.style.minWidth="100px",t.style.textAlign="center",t.style.whiteSpace="nowrap",t.style.position="sticky",t.style.top="0",c.appendChild(t)}return a.appendChild(c),s.appendChild(a),o.appendChild(s),i.appendChild(o),s}function y(e){if(""==e)return"不曾";try{return cyd=new Date(e),cyy=cyd.getFullYear()-1911,cym=cyd.getMonth()+1,cyd=cyd.getDate(),mky="000"+cyy,mky=mky.substring(mky.length-3,mky.length),mkm="00"+cym,mkm=mkm.substring(mkm.length-2,mkm.length),mkd="00"+cyd,mkd=mkd.substring(mkd.length-2,mkd.length),mkdate=mky+mkm+mkd,mkdate}catch(t){return e}}u+=30,i.style.height=u+"px",document.body.insertBefore(i,document.body.firstChild)}}function gotourl(e){window.history.pushState({},"","/peSetting"),window.dispatchEvent(new PopStateEvent("popstate")),window.history.pushState({},"",e),window.dispatchEvent(new PopStateEvent("popstate"))}!function(){var e,t;e=window.history,t=e.pushState,e.pushState=function(n){return setTimeout(function(){document.getElementById("input_fasttype")&&(temptype=document.getElementById("input_fasttype").value),null!=document.getElementById("create_niisdrag")&&document.getElementById("create_niisdrag").remove(),createchest()},0),t.apply(e,arguments)},chestversion="1131216",temptype="",null!=document.getElementById("create_niisdrag")&&document.getElementById("create_niisdrag").remove(),escape_populanceConsultation=confirm("百寶箱版本:"+chestversion+"\n看診前是否自動跳過民眾看診首頁"),createchest()}();
