<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>打口篩</title>
	<style>
		html {
			font-size: 18px;
		}

		#H-container{
			display : flex;
		}
		#H-container > div {
			margin-right: 20px;
		}
        input {
			font-size: 18px; 
			text-align: center;
		}
		.table-container {
            width: 100%; 
            height: 400px; 
            overflow: auto;
            border: 1px solid 
        }
        .table_left {
            width: 400px; 
            border-collapse: collapse;
        }
        .table_left th, td {
            border: 1px solid #ddd; 
            text-align: center; 
        }
		.table_right {
            width: 100%; 
            border-collapse: collapse;
        }
        .table_right th, td {
            border: 1px solid #ddd; 
            text-align: center; 
        }
		Button {
            margin: 2px;
            font-size: 18px; 
            font-weight: 400;
        }
       
		.thebutton {
			padding: 2px; 
			text-decoration: none; 
			font-size: 24px;
			font-family: '微軟正黑體', sans-serif; 
			border-radius: 10px; 
			background-color: #00EC00; 
			transition: background-color 0.3s;
		}
		.thebutton:hover {
			background-color: #53FF53
		}
    </style>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
	

</head>
<body>
	<h1>打口篩報告</h1>
	<div id="H-container">
		<div>
			整篩編號或ID:
			<input type="text" id="thecode" style="width: 120px;"/>
			報告內容(4碼基本資料+1~2碼異常+2碼位置): 
			<input type="text" id="theresult" style="width: 120px;"/>
			<button onclick="adddata()">新增</button>
			<button onclick="deldata()">刪除</button>
			<button onclick="expdata()">匯出</button>
			<input type="file" id="hidden-file-input" accept=".txt" style="display: none;" />
			<button onclick="document.getElementById('hidden-file-input').click()">匯入</button>
			<div class="table-container">
				<table id="table_right" class="table_right">
					<thead>
						<tr>
							<th>編號</th>
							<th>身分證字號</th>
							<th>教育程度</th>
							<th>嚼檳習慣</th>
							<th>吸菸習慣</th>
							<th>自覺症狀</th>
							<th>結果代碼</th>
							<th>位置代碼</th>
					</thead>
					<tbody>
					</tbody>
				</table>
			</div>
		</div>
		<div>
			新陳掛號檔(ExcKH******.xls):
			<input type="file" id="excel-file" accept=".xlsx, .xls" style="width: 283px; display: none;"/>
			<button onclick="document.getElementById('excel-file').click()">讀取Excel</button>
			<button onclick="copytable()">複製</button>
			<div class="table-container" id="table-container"></div>
		</div>
	</div>
	1. 可先從右方匯入新陳掛號檔，有匯入可只輸入整篩末三碼進行查詢
	<br>
	2. 左上方輸入ID或整篩編號，中間的輸入框輸入報告(4碼基本資料，檢查結果1~2碼，位置0~2碼)後點新增
	<br>
	3. 方便快速登打，新增後自動清空ID及報告欄位，並移動到ID欄
	<br>
	4. 輸入錯誤可從表格中直接修改，ID錯誤需刪除重key
	<br>
	5. 支援匯出及匯入
	<br>
	6. 請拖曳下面的按鈕到我的最愛，並在PHPCIIS中搭配使用
	<div style="margin: 8px;">
		<a href='javascript: function createchest(){function t(){if(theurl=document.URL,theurl.includes("https://phpcis.chshb.gov.tw/consultationMainPage/"))if(16==document.getElementsByName("visitTypeId")[1].value)if(null!=document.getElementById("education1")){if(prenum="",preid=document.querySelector("body > div.fade.modal.show > div > div > div.modal-body > form > div:nth-child(2) > div:nth-child(1) > div > label.text-left.commonFormlabel.form-label.col-form-label.col-lg-4").textContent,importobjkey.includes(preid)&&(prenum=importobj[preid]),input=prompt("輸入口篩編號\n含4碼問卷跟1-4碼檢查結果",prenum),null!==input){if(changeevent=new Event("change",{bubbles:!0}),input=input.toUpperCase(),numbers=input.match(/\d+/g)[0],input1=numbers.substring(0,1),input2=numbers.substring(1,2),input3=numbers.substring(2,3),input4=numbers.substring(3,4),input5=numbers.substring(4,input.length),document.querySelector("#education"+input1).click(),document.querySelector("#OCSBetel"+input2).click(),document.querySelector("#OCSSmoke"+input3).click(),"0"==input4?document.querySelector("#isOCSSymptom").click():document.querySelector("#noOCSSymptom").click(),document.querySelector("#oCSResult"+input5).click(),"0"!=input5){for(words=input.match(/\D+/g)[0],input6=words.toUpperCase(),portionlist=["AU","AD","BL","BR","CR","CL","DR","DL","ER","EL","FR","FL","GR","GL","HR","HL","IR","IL","JR","JL","KR","KL","MR","ML","L"],i=0;i<portionlist.length;i++)document.querySelector("#OCSResultPortion"+portionlist[i]).checked&&document.querySelector("#OCSResultPortion"+portionlist[i]).click();document.querySelector("#OCSResultPortion"+input6).click()}document.getElementById("uncontrolled-tab-example-tab-tab2").click(),document.querySelector("img").scrollIntoView(),autosave&&document.querySelector("body > div.fade.modal.show > div > div > div.modal-body > div > div.btn-toolbar > button.btn.btn-primary").click()}}else document.getElementById("ConsultationMainPage_consultationDropDown").click(),document.getElementsByClassName("alignRight")[0].click();else alert("非口篩個案");else alert("非看診畫面")}function e(){if(thecode=document.getElementById("upperinput").value,tb=document.getElementsByClassName("table table-striped table-bordered table-sm role-list__role-table commonTable"),thefind=!1,10==thecode.length){for(theid=thecode,i=0;i<tb.length;i++)if(!tb[i].textContent.includes("無資料"))for(j=1;j<tb[i].rows.length;j++)if(tb[i].rows[j].cells[3].textContent==theid&&tb[i].rows[j].cells[7].textContent.includes("6G")){tb[i].rows[j].cells[4].children[0].click(),thefind=!0;break}thefind||alert("查無"+theid+"該診次掛6G紀錄")}else if(isexamnum)if(oralobjkey.includes(thecode)){for(theid=oralobj[thecode],i=0;i<tb.length;i++)if(!tb[i].textContent.includes("無資料"))for(j=1;j<tb[i].rows.length;j++)if(tb[i].rows[j].cells[3].textContent==theid&&tb[i].rows[j].cells[7].textContent.includes("6G")){tb[i].rows[j].cells[4].children[0].click(),thefind=!0;break}thefind||alert("查無"+theid+"該診次掛6G紀錄")}else alert("整篩編號錯誤");else alert("輸入長度錯誤")}function n(){thewidth=105,theheight=55,borderx=20,bordery=50;var t=document.createElement("div");function e(e){posX=mouseX-e.clientX,posY=mouseY-e.clientY,mouseX=e.clientX,mouseY=e.clientY,t.style.left=t.offsetLeft-posX+"px",t.style.top=t.offsetTop-posY+"px"}function n(){document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",n)}t.id="myDraggable",t.style.width=thewidth+"px",t.style.left=window.innerWidth-300+"px",t.style.height=theheight+"px",t.style.top=bordery+"px",t.style.background="#f9f9f9",t.style.border="1px solid #ccc",t.style.position="absolute",t.style.cursor="move",t.style.zIndex="9999",document.body.insertBefore(t,document.body.firstChild),t.addEventListener("mousedown",function(t){mouseX=t.clientX,mouseY=t.clientY,document.addEventListener("mousemove",e),document.addEventListener("mouseup",n)})}function o(){exckhrow=prompt("請貼上新陳ExcKH的前三欄");try{for(A_exckhrow=exckhrow.split("\r\n"),oralobj={},oralobjkey=[],i=1;i<A_exckhrow.length;i++)line=A_exckhrow[i].split("\t"),number=line[2],number=number.substring(number.length-3),oralobj[number]=line[0],oralobjkey=Object.keys(oralobj);isexamnum=!0,alert("匯入成功")}catch(t){alert("匯入失敗")}}function l(){lowernum=document.getElementById("lowernum").value,m(lowernum)&&(lowernum<=1?document.getElementById("lowernum").value="1":(lowernum=1*lowernum-1,document.getElementById("lowernum").value=lowernum),document.getElementById("lowernum").dispatchEvent(changeevent))}function u(){lowernum=document.getElementById("lowernum").value,m(lowernum)&&lowernum<importobjkey.length&&(lowernum=1*lowernum+1,document.getElementById("lowernum").value=lowernum,document.getElementById("lowernum").dispatchEvent(changeevent))}function r(){lowernum=document.getElementById("lowernum").value,m(lowernum)?lowernum>0&&lowernum<=importobjkey.length?(document.getElementById("upperinput").value=importobjkey[lowernum-1],upperinput=importobjkey[lowernum]):(document.getElementById("lowernum").value="1",document.getElementById("lowernum").dispatchEvent(changeevent),alert("不在報告列表中")):(alert("不可輸入非數字"),document.getElementById("lowernum").value="1",document.getElementById("lowernum").dispatchEvent(changeevent))}function p(){document.querySelector("#root > div.wrapper > main > div > div:nth-child(21) > div.mb-3.btn-toolbar > div > button:nth-child(11)").click()}function m(t){return/^\d+$/.test(t)}ccc=document.URL,d0="https://phpcis.chshb.gov.tw/consultationMainPage/",d1="https://phpcis.chshb.gov.tw/populanceRegistration",d6="https://phpcis.chshb.gov.tw/populanceConsultation/",document.getElementById("myDraggable")&&document.getElementById("myDraggable").remove(),ccc.includes(d0)?(n(),button_OR=document.createElement("button"),button_OR.textContent="口篩問卷",button_OR.style.width="100px",button_OR.style.height="50px",button_OR.style.left="2px",button_OR.style.top="2px",button_OR.style.position="absolute",button_OR.addEventListener("click",t),myDraggable.appendChild(button_OR),button_exit=document.createElement("button"),button_exit.textContent="離開",button_exit.style.width="100px",button_exit.style.height="50px",button_exit.style.left="104px",button_exit.style.top="2px",button_exit.style.position="absolute",button_exit.addEventListener("click",p),myDraggable.appendChild(button_exit),myDraggable.style.height="55px",myDraggable.style.width="206px",myDraggable.style.left=window.innerWidth-400+"px"):ccc==d1?(n(),button_importxls=document.createElement("button"),button_importxls.textContent="匯入新陳",button_importxls.style.width="100px",button_importxls.style.height="25px",button_importxls.style.left="2px",button_importxls.style.top="2px",button_importxls.style.position="absolute",button_importxls.addEventListener("click",o),myDraggable.appendChild(button_importxls),input_upperinput=document.createElement("input"),input_upperinput.value=upperinput,input_upperinput.id="upperinput",input_upperinput.style.width="150px",input_upperinput.style.height="25px",input_upperinput.style.left="104px",input_upperinput.style.top="2px",input_upperinput.style.textAlign="center",input_upperinput.style.position="absolute",myDraggable.appendChild(input_upperinput),button_uppersearch=document.createElement("button"),button_uppersearch.textContent="到個案",button_uppersearch.style.width="100px",button_uppersearch.style.height="52px",button_uppersearch.style.left="256px",button_uppersearch.style.top="2px",button_uppersearch.style.position="absolute",button_uppersearch.addEventListener("click",e),myDraggable.appendChild(button_uppersearch),hidden_importtxt=document.createElement("input"),hidden_importtxt.id="hidden-file-input",hidden_importtxt.type="file",hidden_importtxt.accept=".txt",hidden_importtxt.style.display="none",hidden_importtxt.addEventListener("change",function(t){file=t.target.files[0],file?(reader=new FileReader,reader.onload=function(t){try{for(importobj={},importobjkey=[],content=t.target.result,acontent=content.split("\n"),aaa=0;aaa<acontent.length;aaa++)acontentl=acontent[aaa].split(","),importobj[acontentl[0]]=acontentl[1]+acontentl[2]+acontentl[3]+acontentl[4]+acontentl[5]+acontentl[6];importobjkey=Object.keys(importobj),isimportobj=!0,input_lowernum.value="1",document.getElementById("lowernum").dispatchEvent(changeevent)}catch(t){importobj={},importobjkey=[],isimportobj=!1,alert("出錯了")}button_lowernum_up.disabled=!isimportobj,button_lowernum_down.disabled=!isimportobj,input_lowernum.disabled=!isimportobj},reader.readAsText(file)):alert("無選擇文件")}),myDraggable.appendChild(hidden_importtxt),button_importtxt=document.createElement("button"),button_importtxt.textContent="匯入報告",button_importtxt.style.width="100px",button_importtxt.style.height="25px",button_importtxt.style.left="2px",button_importtxt.style.top="29px",button_importtxt.style.position="absolute",button_importtxt.onclick=function(){document.getElementById("hidden-file-input").click()},myDraggable.appendChild(button_importtxt),button_lowernum_up=document.createElement("button"),button_lowernum_up.textContent="+",button_lowernum_up.style.width="25px",button_lowernum_up.style.height="25px",button_lowernum_up.style.left="104px",button_lowernum_up.style.top="29px",button_lowernum_up.style.position="absolute",button_lowernum_up.addEventListener("click",u),button_lowernum_up.disabled=!isimportobj,myDraggable.appendChild(button_lowernum_up),button_lowernum_down=document.createElement("button"),button_lowernum_down.textContent="-",button_lowernum_down.style.width="25px",button_lowernum_down.style.height="25px",button_lowernum_down.style.left="131px",button_lowernum_down.style.top="29px",button_lowernum_down.style.position="absolute",button_lowernum_down.addEventListener("click",l),myDraggable.appendChild(button_lowernum_down),button_lowernum_down.disabled=!isimportobj,input_lowernum=document.createElement("input"),input_lowernum.value=lowernum,input_lowernum.id="lowernum",input_lowernum.style.width="96px",input_lowernum.style.height="25px",input_lowernum.style.left="158px",input_lowernum.style.top="29px",input_lowernum.style.textAlign="center",input_lowernum.style.position="absolute",input_lowernum.disabled=!isimportobj,input_lowernum.addEventListener("change",r),myDraggable.appendChild(input_lowernum),myDraggable.style.height="55px",myDraggable.style.width="308px",myDraggable.style.left=window.innerWidth-400+"px"):ccc.includes(d6)&&escape_populanceConsultation&&document.getElementsByClassName("commonBtn btn btn-primary")[1].click()}!function(){var t,e;autosave=confirm("口篩結果是否自動儲存?"),escape_populanceConsultation=!0,oralobj={},oralobjkey=[],upperinput="",lowernum="",isexamnum=!1,importobj={},importobjkey=[],isimportobj=!1,changeevent=new Event("change",{bubbles:!0}),t=window.history,e=t.pushState,t.pushState=function(n){return setTimeout(function(){document.getElementById("upperinput")&&(upperinput=document.getElementById("upperinput").value),document.getElementById("lowernum")&&(lowernum=document.getElementById("lowernum").value),createchest()},0),e.apply(t,arguments)},createchest()}();' class="thebutton" draggable="true">口篩助手</a>
	</div>
	1. 在PHPCIIS中使用時會先跳出詢問視窗，打完口篩報告後是否儲存
	<br>
	2. 掛號列表請手動選到整篩口篩診次
	<br>
	3. 掛號列表可匯入新陳掛號檔的前三行(可從此網頁中匯入後點複製後貼入即可)已及匯入此網頁打完的報告
	<br>
	4. 輸入ID後點到個案可直接進入個案打報告的畫面中
	<br>
	4-1. 有匯入掛號檔可直接輸入整篩便號末三碼)
	<br>
	4-2. 有匯入報告可使用"+"或"-"選擇報告編號，可自動帶入ID
	<br>
	5. 看診畫面點口篩問卷，一樣輸入代碼(4碼基本資料，檢查結果1~2碼，位置0~2碼)可自動填問卷
	<br>
	5-1. 有匯入報告時會自動帶入報告的結果
	<br>
	6. 離開按鈕連結到看診畫面的離開，放大更好點選
	<script>window.addEventListener("beforeunload",function(e){return e.returnValue="你確定要離開嗎？","你確定要離開嗎？"});var numbertoidobj={},tempcount=0;const fileInput=document.getElementById("hidden-file-input");fileInput.addEventListener("change",function(e){const t=e.target.files[0];if(t){const e=new FileReader;e.onload=function(e){const t=e.target.result;for(document.querySelector("#table_right > tbody").innerHTML="",tempcount=0,acontent=t.split("\n"),tb=document.getElementById("table_right"),aaa=0;aaa<acontent.length;aaa++)for(acontentl=acontent[aaa].split(","),row=tb.children[1].insertRow(),tempcount+=1,cell=row.insertCell(),cell.textContent=tempcount,inputradio=document.createElement("input"),inputradio.type="radio",inputradio.name="currentselection",cell.appendChild(inputradio),cell=row.insertCell(),cell.addEventListener("click",function(e){if(clickedRow=e.target.closest("tr"),clickedRow){const e=clickedRow.querySelector('input[type="radio"]');e&&e.click()}}),cell.textContent=acontentl[0].toUpperCase(),i=0;i<6;i++)cell=row.insertCell(),cell.addEventListener("click",function(e){if(clickedRow=e.target.closest("tr"),clickedRow){const e=clickedRow.querySelector('input[type="radio"]');e&&e.click()}}),inputcell=document.createElement("input"),inputcell.style.width="50px",inputcell.style.textAlign="center",inputcell.value=acontentl[1+i],inputcell.addEventListener("click",function(e){if(clickedRow=e.target.closest("tr"),clickedRow){const e=clickedRow.querySelector('input[type="radio"]');e&&e.click()}}),cell.appendChild(inputcell)},e.readAsText(t)}else alert("無選擇文件")});const excelInput=document.getElementById("excel-file");function readExcel(){const e=document.getElementById("excel-file"),t=document.getElementById("table-container");if(!e.files.length)return void(t.innerHTML="請選擇一個文件。");const n=new FileReader;n.onload=function(e){const n=new Uint8Array(e.target.result),l=XLSX.read(n,{type:"array"}),r=l.SheetNames[0],i=l.Sheets[r],c=XLSX.utils.decode_range(i["!ref"]);let o='<table class="table_left"><tbody>';numbertoidobj={};for(let e=0;e<=c.e.r;++e){o+="<tr>";let t="",n="";for(let l=0;l<3;l++){const r={c:l,r:e},c=i[XLSX.utils.encode_cell(r)],s=c?c.v:"";o+=`<td>${s}</td>`,0===l&&(t=s),2===l&&(n=s)}if(o+="</tr>",n&&n.length>=3){const e=n.slice(-3);numbertoidobj[e]=t}}o+="</tbody></table>",t.innerHTML=o},n.readAsArrayBuffer(e.files[0])}function adddata(){if(errmsg="",thecode=document.getElementById("thecode").value,3==thecode.length?Object.keys(numbertoidobj).length>0?Object.keys(numbertoidobj).includes(thecode)?thecode=numbertoidobj[thecode]:errmsg+="無整篩編號\n":errmsg+="無匯入整篩掛號檔不可使用整篩編號查詢\n":10!=thecode.length&&(errmsg+="字串長度須為3或10\n"),""==errmsg)if(errmsg="",theresult=document.getElementById("theresult").value,errmsgobj=checkinputvalid(theresult),""==errmsgobj.errmsg){for(tb=document.getElementById("table_right"),row=tb.children[1].insertRow(),tempcount+=1,cell=row.insertCell(),cell.textContent=tempcount,inputradio=document.createElement("input"),inputradio.type="radio",inputradio.name="currentselection",cell.appendChild(inputradio),cell=row.insertCell(),cell.addEventListener("click",function(e){if(clickedRow=e.target.closest("tr"),clickedRow){const e=clickedRow.querySelector('input[type="radio"]');e&&e.click()}}),cell.textContent=thecode.toUpperCase(),i=0;i<6;i++)cell=row.insertCell(),cell.addEventListener("click",function(e){if(clickedRow=e.target.closest("tr"),clickedRow){const e=clickedRow.querySelector('input[type="radio"]');e&&e.click()}}),inputcell=document.createElement("input"),inputcell.style.width="50px",inputcell.style.textAlign="center",inputcell.value=errmsgobj.content[i],inputcell.addEventListener("click",function(e){if(clickedRow=e.target.closest("tr"),clickedRow){const e=clickedRow.querySelector('input[type="radio"]');e&&e.click()}}),cell.appendChild(inputcell);document.getElementById("thecode").value="",document.getElementById("theresult").value="",document.getElementById("thecode").focus()}else alert(errmsg);else alert(errmsg)}function checkinputvalid(e){let t={};return errmsg="",input=e.toUpperCase(),numbers=input.match(/\d+/g),null==numbers?errmsg+="結果沒有數字\n":(numbers=numbers[0],numbers.length<5?errmsg+="結果數字長度錯誤\n":(input1=numbers.substring(0,1),["1","2","3","4","5","6","7"].includes(input1)||(errmsg+="教育須為1~7\n"),input2=numbers.substring(1,2),["0","1","2","3","4","5"].includes(input2)||(errmsg+="嚼檳榔習慣須為0~5\n"),input3=numbers.substring(2,3),["0","1","2","3","4","5"].includes(input3)||(errmsg+="吸菸習慣須為0~5\n"),input4=numbers.substring(3,4),["0","1"].includes(input4)||(errmsg+="自覺症狀須為0~1\n"),0!=input2||0!=input3&&1!=input3||(errmsg+="不符合幾付條件(不曾嚼檳且現未抽菸)\n"),input5=numbers.substring(4,input.length),["0","1","3","4","71","72","73","2","5","76","8","9","10","99"].includes(input4)||(errmsg+="檢查結果代碼錯誤\n"),"0"!=input5?(words=input.match(/\D+/g),null==words?errmsg+="結果沒有英文\n":(words=words[0],input6=words.toUpperCase(),portionlist=["AU","AD","BL","BR","CR","CL","DR","DL","ER","EL","FR","FL","GR","GL","HR","HL","IR","IL","JR","JL","KR","KL","MR","ML","L"],portionlist.includes(input6)||(errmsg+="位置代碼錯誤\n"))):(words=input.match(/\D+/g),null==words?input6="":errmsg+="檢查結果0不應有位置\n"))),""==errmsg?(t.status="suscess",t.content=[input1,input2,input3,input4,input5,input6]):(t.status="failure",t.content=[]),t.errmsg=errmsg,t}function deldata(){for(radio of(radios=document.getElementsByName("currentselection"),selected=!1,radios))if(radio.checked){selectedRadio=radio;break}selectedRadio?confirm("是否刪除?")&&(rowToDelete=selectedRadio.closest("tr"),rowToDelete&&(table=rowToDelete.closest("table"),table&&(rowIndex=rowToDelete.rowIndex,table.deleteRow(rowIndex)))):alert("未選擇")}function expdata(){if(tb=document.getElementById("table_right"),tb.rows.length>1){for(retmsg="",count=0,i=1;i<tb.rows.length;i++){for(count+=1,retmsg+=tb.rows[i].cells[1].textContent,j=2;j<8;j++)retmsg+=","+tb.rows[i].cells[j].children[0].value;retmsg+="\n"}retmsg=retmsg.substring(0,retmsg.length-1),download("口篩報告_"+count+"筆.txt",retmsg)}else alert("無紀錄")}function download(e,t){var n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),n.setAttribute("download",e),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}function copytable(){if(exceltblist=document.getElementsByClassName("table_left"),exceltblist.length>0){for(thetb=document.getElementsByClassName("table_left")[0],tempclip="",i=0;i<thetb.rows.length;i++)tempclip+=thetb.rows[i].cells[0].textContent+"\t"+thetb.rows[i].cells[1].textContent+"\t"+thetb.rows[i].cells[2].textContent+"\r\n";tempclip=tempclip.substring(0,tempclip.length-2),navigator.clipboard.writeText(tempclip),alert("已複製到剪貼簿")}else alert("未匯入新陳掛號檔")}excelInput.addEventListener("change",function(e){e.target.files[0]?readExcel():alert("無選擇文件")});</script>
    
</body>
</html>
